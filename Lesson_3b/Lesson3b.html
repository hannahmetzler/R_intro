<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hannah Metzler">
<meta name="dcterms.date" content="2024-03-27">

<title>Lesson 3 extension: Data wrangling, t-tests and ANOVA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Lesson3b_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lesson3b_files/libs/quarto-html/quarto.js"></script>
<script src="Lesson3b_files/libs/quarto-html/popper.min.js"></script>
<script src="Lesson3b_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Lesson3b_files/libs/quarto-html/anchor.min.js"></script>
<link href="Lesson3b_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lesson3b_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Lesson3b_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Lesson3b_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Lesson3b_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#project-for-extension-of-lesson-3-comparison-of-baby-names-in-austria-and-the-us" id="toc-project-for-extension-of-lesson-3-comparison-of-baby-names-in-austria-and-the-us" class="nav-link active" data-scroll-target="#project-for-extension-of-lesson-3-comparison-of-baby-names-in-austria-and-the-us"><span class="header-section-number">1</span> Project for extension of lesson 3: Comparison of baby names in Austria and the US</a></li>
  <li><a href="#reading-in-and-looking-at-data" id="toc-reading-in-and-looking-at-data" class="nav-link" data-scroll-target="#reading-in-and-looking-at-data"><span class="header-section-number">2</span> Reading in and looking at data</a>
  <ul class="collapse">
  <li><a href="#data-from-austria" id="toc-data-from-austria" class="nav-link" data-scroll-target="#data-from-austria"><span class="header-section-number">2.1</span> Data from Austria</a></li>
  <li><a href="#data-from-the-us" id="toc-data-from-the-us" class="nav-link" data-scroll-target="#data-from-the-us"><span class="header-section-number">2.2</span> Data from the US</a></li>
  </ul></li>
  <li><a href="#get-an-overview-of-the-dataset" id="toc-get-an-overview-of-the-dataset" class="nav-link" data-scroll-target="#get-an-overview-of-the-dataset"><span class="header-section-number">3</span> Get an overview of the dataset</a></li>
  <li><a href="#cleaning-and-organizing-the-data" id="toc-cleaning-and-organizing-the-data" class="nav-link" data-scroll-target="#cleaning-and-organizing-the-data"><span class="header-section-number">4</span> Cleaning and organizing the data</a>
  <ul class="collapse">
  <li><a href="#renaming-columns" id="toc-renaming-columns" class="nav-link" data-scroll-target="#renaming-columns"><span class="header-section-number">4.1</span> Renaming columns</a></li>
  <li><a href="#selecting-rows" id="toc-selecting-rows" class="nav-link" data-scroll-target="#selecting-rows"><span class="header-section-number">4.2</span> Selecting rows</a></li>
  <li><a href="#changing-the-format-of-columns" id="toc-changing-the-format-of-columns" class="nav-link" data-scroll-target="#changing-the-format-of-columns"><span class="header-section-number">4.3</span> Changing the format of columns</a></li>
  <li><a href="#create-a-new-variable" id="toc-create-a-new-variable" class="nav-link" data-scroll-target="#create-a-new-variable"><span class="header-section-number">4.4</span> Create a new variable</a></li>
  <li><a href="#grouping-data-and-summarising-statistics" id="toc-grouping-data-and-summarising-statistics" class="nav-link" data-scroll-target="#grouping-data-and-summarising-statistics"><span class="header-section-number">4.5</span> Grouping data and summarising statistics</a></li>
  <li><a href="#filter-out-one-name" id="toc-filter-out-one-name" class="nav-link" data-scroll-target="#filter-out-one-name"><span class="header-section-number">4.6</span> Filter out one name</a></li>
  </ul></li>
  <li><a href="#combine-two-data-frames" id="toc-combine-two-data-frames" class="nav-link" data-scroll-target="#combine-two-data-frames"><span class="header-section-number">5</span> Combine two data frames</a></li>
  <li><a href="#figures-script" id="toc-figures-script" class="nav-link" data-scroll-target="#figures-script"><span class="header-section-number">6</span> Figures script</a></li>
  <li><a href="#statistics-script" id="toc-statistics-script" class="nav-link" data-scroll-target="#statistics-script"><span class="header-section-number">7</span> Statistics script</a>
  <ul class="collapse">
  <li><a href="#t-test-by-country" id="toc-t-test-by-country" class="nav-link" data-scroll-target="#t-test-by-country"><span class="header-section-number">7.1</span> T-test by country</a></li>
  <li><a href="#multi-factorial-anova-difference-in-name-popularity-by-sex-and-country" id="toc-multi-factorial-anova-difference-in-name-popularity-by-sex-and-country" class="nav-link" data-scroll-target="#multi-factorial-anova-difference-in-name-popularity-by-sex-and-country"><span class="header-section-number">7.2</span> Multi-factorial ANOVA: Difference in name popularity by sex and country</a></li>
  <li><a href="#make-a-table-with-statistics-and-export-it-to-a-csv-file" id="toc-make-a-table-with-statistics-and-export-it-to-a-csv-file" class="nav-link" data-scroll-target="#make-a-table-with-statistics-and-export-it-to-a-csv-file"><span class="header-section-number">7.3</span> Make a table with statistics and export it to a csv-file:</a></li>
  </ul></li>
  <li><a href="#transforming-data-from-long-to-wide-format" id="toc-transforming-data-from-long-to-wide-format" class="nav-link" data-scroll-target="#transforming-data-from-long-to-wide-format"><span class="header-section-number">8</span> Transforming data from long to wide format</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lesson 3 extension: Data wrangling, t-tests and ANOVA</h1>
<p class="subtitle lead">Course website: https://hannahmetzler.eu/R_intro/</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hannah Metzler </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 27, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="project-for-extension-of-lesson-3-comparison-of-baby-names-in-austria-and-the-us" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="project-for-extension-of-lesson-3-comparison-of-baby-names-in-austria-and-the-us"><span class="header-section-number">1</span> Project for extension of lesson 3: Comparison of baby names in Austria and the US</h2>
<p>What about baby names in Austria?</p>
<p>Below, we read in data from Austria, make it comparable to the US data set, and then run a t-test to compare the popularity of baby names in the two countries.</p>
</section>
<section id="reading-in-and-looking-at-data" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="reading-in-and-looking-at-data"><span class="header-section-number">2</span> Reading in and looking at data</h2>
<section id="data-from-austria" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="data-from-austria"><span class="header-section-number">2.1</span> Data from Austria</h3>
<ul>
<li>I downloaded data about given names in Austria from 1984 to 2022 from <a href="https://www.data.gv.at/katalog/de/dataset/stat_vornamen#resources">data.bv.at</a>. Download the first file from there and put it into your data folder.</li>
</ul>
<p>Continue working in your cleaning script from lesson 3, in the # READ DATA #### section.</p>
<ul>
<li>To read the Austrian data, try the function <code>csv()</code>.</li>
<li>Add this after the lines that read in the data from the USA.</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-2_d0d4c2de528e531de0269fff0d3a1a73">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data_aut <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">'data/OGDEXT_VORNAMEN_1.csv'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_aut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  `C-JAHR-0;C-WOHNBEZIRK-0;C-GESCHLECHT-0;F-VORNAME_NORMALISIERT;F-ANZAHL_LGEB`
  &lt;chr&gt;                                                                        
1 1984;101;1;Andreas;4                                                         
2 1984;101;1;Bernd;1                                                           
3 1984;101;1;Christian;2                                                       
4 1984;101;1;Christoph;2                                                       
5 1984;101;1;Clemens;1                                                         
6 1984;101;1;Daniel;3                                                          </code></pre>
</div>
</div>
<p>You can see that the data was not read in correctly. Why?</p>
<ul>
<li>Cells in CSV-files are most commonly separated by a comma, with the point used for the decimal point.</li>
<li>In some European countries (including Austria) cells are instead separated by a semicolon, and a comma used as the decimal point.</li>
<li>Here, you can see that these data from Austria are indeed separated by a semicolon.</li>
<li>If you check the help section for <code>?read_csv</code>, you see that you can use the function <code>read_csv2()</code> to read in CSV-files with the field separator <code>;</code>.</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-3_3d59b14d2aa249717d9e7b8bf00848cd">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data_aut <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(<span class="st">'data/OGDEXT_VORNAMEN_1.csv'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_aut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  `C-JAHR-0` `C-WOHNBEZIRK-0` `C-GESCHLECHT-0` `F-VORNAME_NORMALISIERT`
       &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt; &lt;chr&gt;                   
1       1984              101                1 Andreas                 
2       1984              101                1 Bernd                   
3       1984              101                1 Christian               
4       1984              101                1 Christoph               
5       1984              101                1 Clemens                 
6       1984              101                1 Daniel                  
# ℹ 1 more variable: `F-ANZAHL_LGEB` &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="data-from-the-us" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="data-from-the-us"><span class="header-section-number">2.2</span> Data from the US</h3>
<p>Here, I load the baby names data set, a default package included in the library “babynames”. To run the code below, you first need to install the package, and then load it by adding <code>library(babynames)</code> in your section for loading packages. This dataset, as opposed to the smaller one we used in lesson 3, includes all given names in the US, not just the ones from our course participants. Assign the dataset to <code>data_usa</code>.</p>
<div class="cell" data-hash="Lesson3b_cache/html/read in US babynames data_fe4abcf287ba2e828ab325acad9a814a">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the dataset</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(babynames)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># assign it to data_usa</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>data_usa <span class="ot">=</span> babynames</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="get-an-overview-of-the-dataset" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="get-an-overview-of-the-dataset"><span class="header-section-number">3</span> Get an overview of the dataset</h2>
<p>To get an overview of this new data set, you could use any of the following functions:</p>
<ul>
<li>You know <code>glimpse()</code> from lesson 3.</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-4_090ca54396ee3d371e2d37c53fd89c7d">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(data_aut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,265,460
Columns: 5
$ `C-JAHR-0`               &lt;dbl&gt; 1984, 1984, 1984, 1984, 1984, 1984, 1984, 198…
$ `C-WOHNBEZIRK-0`         &lt;dbl&gt; 101, 101, 101, 101, 101, 101, 101, 101, 101, …
$ `C-GESCHLECHT-0`         &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ `F-VORNAME_NORMALISIERT` &lt;chr&gt; "Andreas", "Bernd", "Christian", "Christoph",…
$ `F-ANZAHL_LGEB`          &lt;dbl&gt; 4, 1, 2, 2, 1, 3, 2, 1, 3, 1, 1, 1, 1, 1, 1, …</code></pre>
</div>
</div>
<ul>
<li>summary() shows us that the earliest year in the data is 1984, the latest one 2022.
<ul>
<li>It also shows us that the column “Geschlecht” (sex) is not yet coded as a categorical variable.</li>
</ul></li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-5_d7f1e1f1cd7fb19084b5c589540bd493">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_aut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    C-JAHR-0    C-WOHNBEZIRK-0 C-GESCHLECHT-0  F-VORNAME_NORMALISIERT
 Min.   :1984   Min.   :101    Min.   :1.000   Length:1265460        
 1st Qu.:1996   1st Qu.:319    1st Qu.:1.000   Class :character      
 Median :2007   Median :506    Median :2.000   Mode  :character      
 Mean   :2005   Mean   :563    Mean   :1.535                         
 3rd Qu.:2015   3rd Qu.:804    3rd Qu.:2.000                         
 Max.   :2022   Max.   :923    Max.   :2.000                         
 F-ANZAHL_LGEB  
 Min.   : 1.00  
 1st Qu.: 1.00  
 Median : 1.00  
 Mean   : 2.36  
 3rd Qu.: 2.00  
 Max.   :76.00  </code></pre>
</div>
</div>
<ul>
<li>The function <code>View()</code> opens the data in an extra window.</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-6_38a03bb9036c297c003b2824b9915e60">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(data_aut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The function <code>str()</code> shows you the structure of the data set.</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-7_852878995302ae95694b7907a65b2fbf">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_aut) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [1,265,460 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ C-JAHR-0              : num [1:1265460] 1984 1984 1984 1984 1984 ...
 $ C-WOHNBEZIRK-0        : num [1:1265460] 101 101 101 101 101 101 101 101 101 101 ...
 $ C-GESCHLECHT-0        : num [1:1265460] 1 1 1 1 1 1 1 1 1 1 ...
 $ F-VORNAME_NORMALISIERT: chr [1:1265460] "Andreas" "Bernd" "Christian" "Christoph" ...
 $ F-ANZAHL_LGEB         : num [1:1265460] 4 1 2 2 1 3 2 1 3 1 ...
 - attr(*, "spec")=
  .. cols(
  ..   `C-JAHR-0` = col_double(),
  ..   `C-WOHNBEZIRK-0` = col_double(),
  ..   `C-GESCHLECHT-0` = col_double(),
  ..   `F-VORNAME_NORMALISIERT` = col_character(),
  ..   `F-ANZAHL_LGEB` = col_double()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
</div>
</section>
<section id="cleaning-and-organizing-the-data" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="cleaning-and-organizing-the-data"><span class="header-section-number">4</span> Cleaning and organizing the data</h2>
<section id="renaming-columns" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="renaming-columns"><span class="header-section-number">4.1</span> Renaming columns</h3>
<p>Let’s use more useful column names for coding, and choose the same names as in the US baby names data. Check the names of the US data with <code>names()</code>:</p>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-8_5e6b64bf8b2c25676d30a6a57ec8d6a6">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_usa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "year" "sex"  "name" "n"    "prop"</code></pre>
</div>
</div>
<p>We can use the <code>dplyr::rename()</code>function to change column names.</p>
<ul>
<li>You simply assign each old variable name (in quotation marks) to the new variable name.</li>
<li>Add the following in your # CLEAN DATA #### section:</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-9_bbaa2e888553d810a7bfbaa14cd975d9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_aut_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
   year living_district   sex name          n
  &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
1  1984             101     1 Andreas       4
2  1984             101     1 Bernd         1
3  1984             101     1 Christian     2
4  1984             101     1 Christoph     2
5  1984             101     1 Clemens       1
6  1984             101     1 Daniel        3</code></pre>
</div>
</div>
</section>
<section id="selecting-rows" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="selecting-rows"><span class="header-section-number">4.2</span> Selecting rows</h3>
<p>If we compare the US and the Austrian data set, we can see that they cover different time spans.</p>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-10_46dceac35ae7b55619cdcdb62de2b65c">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_usa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      year          sex                name                 n          
 Min.   :1880   Length:1924665     Length:1924665     Min.   :    5.0  
 1st Qu.:1951   Class :character   Class :character   1st Qu.:    7.0  
 Median :1985   Mode  :character   Mode  :character   Median :   12.0  
 Mean   :1975                                         Mean   :  180.9  
 3rd Qu.:2003                                         3rd Qu.:   32.0  
 Max.   :2017                                         Max.   :99686.0  
      prop          
 Min.   :2.260e-06  
 1st Qu.:3.870e-06  
 Median :7.300e-06  
 Mean   :1.363e-04  
 3rd Qu.:2.288e-05  
 Max.   :8.155e-02  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_aut_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      year      living_district      sex            name          
 Min.   :1984   Min.   :101     Min.   :1.000   Length:1265460    
 1st Qu.:1996   1st Qu.:319     1st Qu.:1.000   Class :character  
 Median :2007   Median :506     Median :2.000   Mode  :character  
 Mean   :2005   Mean   :563     Mean   :1.535                     
 3rd Qu.:2015   3rd Qu.:804     3rd Qu.:2.000                     
 Max.   :2022   Max.   :923     Max.   :2.000                     
       n        
 Min.   : 1.00  
 1st Qu.: 1.00  
 Median : 1.00  
 Mean   : 2.36  
 3rd Qu.: 2.00  
 Max.   :76.00  </code></pre>
</div>
</div>
<p>Let’s keep only years we have in both datasets. First, filtering the Austrian dataset:</p>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-11_00dbecb02b8965f115fe701518c2823b">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years up to 2017</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2017</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the new data frame</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_aut_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      year      living_district      sex            name          
 Min.   :1984   Min.   :101     Min.   :1.000   Length:1047654    
 1st Qu.:1994   1st Qu.:319     1st Qu.:1.000   Class :character  
 Median :2004   Median :506     Median :2.000   Mode  :character  
 Mean   :2002   Mean   :560     Mean   :1.541                     
 3rd Qu.:2011   3rd Qu.:804     3rd Qu.:2.000                     
 Max.   :2017   Max.   :923     Max.   :2.000                     
       n         
 Min.   : 1.000  
 1st Qu.: 1.000  
 Median : 1.000  
 Mean   : 2.458  
 3rd Qu.: 2.000  
 Max.   :76.000  </code></pre>
</div>
</div>
<ul>
<li>Next, filter out all years before 1984 from the USA data set:</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-12_3129dbae43035607b686bb77da3e29cb">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data_usa_clean <span class="ot">=</span> data_usa <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years from 1984 on</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1983</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_usa_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      year          sex                name                 n          
 Min.   :1984   Length:982833      Length:982833      Min.   :    5.0  
 1st Qu.:1994   Class :character   Class :character   1st Qu.:    7.0  
 Median :2003   Mode  :character   Mode  :character   Median :   11.0  
 Mean   :2002                                         Mean   :  129.1  
 3rd Qu.:2010                                         3rd Qu.:   29.0  
 Max.   :2017                                         Max.   :67736.0  
      prop          
 Min.   :2.260e-06  
 1st Qu.:3.290e-06  
 Median :5.640e-06  
 Mean   :6.431e-05  
 3rd Qu.:1.438e-05  
 Max.   :3.610e-02  </code></pre>
</div>
</div>
</section>
<section id="changing-the-format-of-columns" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="changing-the-format-of-columns"><span class="header-section-number">4.3</span> Changing the format of columns</h3>
<p>To run tests comparing both countries, we need to join both data frames into one. There are several steps to prepare our data sets for this.</p>
<ul>
<li>First, columns in both data frames need the same format.</li>
<li>The US data had the following formats (see second column):</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-13_adc8a807a0b8a2b3ee9672c9d40f7367">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(data_usa_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 982,833
Columns: 5
$ year &lt;dbl&gt; 1984, 1984, 1984, 1984, 1984, 1984, 1984, 1984, 1984, 1984, 1984,…
$ sex  &lt;chr&gt; "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", …
$ name &lt;chr&gt; "Jennifer", "Jessica", "Ashley", "Amanda", "Sarah", "Stephanie", …
$ n    &lt;int&gt; 50561, 45855, 38770, 33907, 25882, 23022, 22264, 21889, 21491, 20…
$ prop &lt;dbl&gt; 0.02804442, 0.02543416, 0.02150436, 0.01880703, 0.01435584, 0.012…</code></pre>
</div>
</div>
<p>So, in the Austrian data, we need sex to be a character vector with levels “M” and “F” instead of “1” and “2”.</p>
<ul>
<li>We will use the <code>ifelse()</code> function, within a <code>mutate()</code> call to transform the variable <code>sex</code>.</li>
<li>If you check the help for <code>?ifelse</code>, the Usage section shows you how to use it: <code>ifelse(test, yes, no)</code>.</li>
<li>The arguments for the <code>ifelse()</code> function start with a condition (rows where the column sex is equal to “1”), then specifies what happens if the condition is met (use the label “M”), and then lists what should happen otherwise/else (use the label “F”).</li>
<li>Now, add this as a last line to where you created <code>data_aut_clean</code>:</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-14_4796daf635754289336a9cca630193d4">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years up to 2017</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recode the levels of sex from 1 and 2, to M and F</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"1"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>))</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co"># check if there is now F instead of 1, and M instead of M: </span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data_aut_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,047,654
Columns: 5
$ year            &lt;dbl&gt; 1984, 1984, 1984, 1984, 1984, 1984, 1984, 1984, 1984, …
$ living_district &lt;dbl&gt; 101, 101, 101, 101, 101, 101, 101, 101, 101, 101, 101,…
$ sex             &lt;chr&gt; "M", "M", "M", "M", "M", "M", "M", "M", "M", "M", "M",…
$ name            &lt;chr&gt; "Andreas", "Bernd", "Christian", "Christoph", "Clemens…
$ n               &lt;dbl&gt; 4, 1, 2, 2, 1, 3, 2, 1, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</code></pre>
</div>
</div>
</section>
<section id="create-a-new-variable" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="create-a-new-variable"><span class="header-section-number">4.4</span> Create a new variable</h3>
<p>Next, we need to tell statistics from Austria and the US apart, once they are in a joint data frame. Therefore, let’s add a variable that identifies the country.</p>
<ul>
<li>We use <code>rep()</code> to repeat “Austria” n times, and set <code>nrow()</code> to the number of rows of the Austrian data.</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-15_1d5a9235a69fb9b17d4b662d03f45ac7">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years up to 2017</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recode the levels of sex from 1 and 2, to M and F</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"1"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create a country variable for Austria</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="st">"Austria"</span>, <span class="at">n=</span><span class="fu">nrow</span>(data_aut)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s repeat this step for the USA data. Just add a line to where you started to clean the US data:</p>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-16_7ba5ae1da17561446c4298ba3036e0c0">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>data_usa_clean <span class="ot">=</span> data_usa <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years from 1984 on</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1983</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Create a country variable for the US</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="st">"USA"</span>, <span class="at">n=</span><span class="fu">nrow</span>(babynames)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grouping-data-and-summarising-statistics" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="grouping-data-and-summarising-statistics"><span class="header-section-number">4.5</span> Grouping data and summarising statistics</h3>
<p>The US data did not separate names per living district.</p>
<ul>
<li>To make our Austrian data similar, let’s group names across districts, so that we get the total number of names per year and sex.</li>
<li>Using <code>group_by()</code> first group the data by year, sex and name, because we want the total n for each of these combined categories.
<ul>
<li>We also add the column country, because we want to keep it, although it does not create any additional grouping.</li>
</ul></li>
<li>We then <code>summarise()</code> the data by calculating the <code>sum()</code> of the number of names (n).
<ul>
<li><code>summarise()</code> is similar to <code>mutate()</code>, but creates one line of output per group. Here, it collapses across districts, reducing the row number for each name.</li>
<li><code>mutate()</code> creates as many lines of output as input.</li>
</ul></li>
<li>Finally, we <code>ungroup()</code> the data again.</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-17_a3ae9fb84dcb16915c5604df6bb3cf4e">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years up to 2017</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recode the levels of sex from 1 and 2, to M and F</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"1"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create a country variable for Austria</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="st">"Austria"</span>, <span class="at">n=</span><span class="fu">nrow</span>(data_aut))) <span class="sc">%&gt;%</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#group by year, sex and name and calculate the new sum for each category</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, sex, name, country) <span class="sc">%&gt;%</span> </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we also want to calculate the proportion variable that exists in the US data set (propotion of babies getting each name).</p>
<ul>
<li>N, the total number of babies, is obviously different because the US is larger.</li>
<li>Using the proportion allows us to meaningfully compare the popularity of names between countries.</li>
<li>We first want to calculate the sum of all babies born in each year (<code>n_total</code>), and then divide n of each name by the years’ total.</li>
<li>To calculate the sum per year, we again use <code>group_by()</code>, grouping only by year.
<ul>
<li>We again add country, also this does not create a group, to keep country variable.</li>
</ul></li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-18_f65939194ca654c47df3425419ffa34b">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years up to 2017</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recode the levels of sex from 1 and 2, to M and F</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"1"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create a country variable for Austria</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="st">"Austria"</span>, <span class="at">n=</span><span class="fu">nrow</span>(data_aut))) <span class="sc">%&gt;%</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#group by year, sex and name and calculate the new sum for each category</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, sex, name, country) <span class="sc">%&gt;%</span> </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span>  <span class="co"># see lesson 3 page for documentation</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate total number of birth per year, and then proportion for each name out of this total</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, country) <span class="sc">%&gt;%</span> </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_total =</span> <span class="fu">sum</span>(n), </span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop =</span> n<span class="sc">/</span>n_total) <span class="sc">%&gt;%</span> </span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_aut_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
   year sex   name     country     n n_total      prop
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
1  1984 F     Abigail  Austria     1   83856 0.0000119
2  1984 F     Adele    Austria     2   83856 0.0000239
3  1984 F     Adelheid Austria    23   83856 0.000274 
4  1984 F     Adina    Austria     2   83856 0.0000239
5  1984 F     Adriane  Austria     1   83856 0.0000119
6  1984 F     Agata    Austria     1   83856 0.0000119</code></pre>
</div>
</div>
</section>
<section id="filter-out-one-name" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="filter-out-one-name"><span class="header-section-number">4.6</span> Filter out one name</h3>
<p>Once this is done, you can again filter one name. I recommend taking a name that occurs in both men and women (like “Kim”), so the results of the ANOVA below make more sense.</p>
<p>Add another filter() call to each of the data sets for this. After this, the cleaning and data organizing is finished.</p>
<p>Austrian data set complete data cleaning and organizing:</p>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-19_d7e68b499c542ddf1f74366a6ea2b8a1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years up to 2017</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Re-code the levels of sex from 1 and 2, to M and F</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"1"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create a country variable for Austria</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="st">"Austria"</span>, <span class="at">n=</span><span class="fu">nrow</span>(data_aut))) <span class="sc">%&gt;%</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#group by year, sex and name and calculate the new sum for each category</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, sex, name, country) <span class="sc">%&gt;%</span> </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span>  <span class="co"># see lesson 3 page for documentation</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate total number of birth per year, and then proportion for each name out of this total</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, country) <span class="sc">%&gt;%</span> </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_total =</span> <span class="fu">sum</span>(n), </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop =</span> n<span class="sc">/</span>n_total) <span class="sc">%&gt;%</span> </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter out your name</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Kim"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>USA data set complete data cleaning and organizing:</p>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-20_4dd3537d7c989ca701610cd37d5595d8">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data_usa_clean <span class="ot">=</span> data_usa <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years from 1984 on</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1983</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Create a country variable for the US</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="st">"USA"</span>, <span class="at">n=</span><span class="fu">nrow</span>(data_usa))) <span class="sc">%&gt;%</span> </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter out your name</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Kim"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Have a look at both organized data sets:</p>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-21_34e7101454d63af8d456ecce52301ff7">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_usa_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
   year sex   name      n      prop country
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  
1  1984 F     Kim     387 0.000215  USA    
2  1984 M     Kim      92 0.0000490 USA    
3  1985 F     Kim     348 0.000189  USA    
4  1985 M     Kim      92 0.0000478 USA    
5  1986 F     Kim     281 0.000152  USA    
6  1986 M     Kim      81 0.0000422 USA    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_aut_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
   year sex   name  country     n n_total      prop
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
1  1984 F     Kim   Austria     1   83856 0.0000119
2  1984 M     Kim   Austria     2   83856 0.0000239
3  1985 F     Kim   Austria     3   82379 0.0000364
4  1986 F     Kim   Austria     6   82056 0.0000731
5  1987 F     Kim   Austria     2   81351 0.0000246
6  1988 F     Kim   Austria     7   82545 0.0000848</code></pre>
</div>
</div>
</section>
</section>
<section id="combine-two-data-frames" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="combine-two-data-frames"><span class="header-section-number">5</span> Combine two data frames</h2>
<p>Now we can combine the 2 data frames. We’ll learn about dplyr verbs that work on two data frames. Until now, all verbs (filter, mutate, summarise, rename, recode) manipulated only one data frame.</p>
<ul>
<li>We will use the function <code>full_join</code>: it
<ul>
<li>R looks for column they have in common</li>
<li>then looks for rows that have the same matching values</li>
<li>combines them into a new data frame, including all the other columns from both data frames</li>
</ul></li>
<li><code>full_join()</code> is one of 4 Mutating joins. It keeps all observations from both data frames.</li>
<li>Check out inner_join, right_join, and left_join with the Examples provided in the help on <code>?full_join</code> when you have a moment. It takes a bit of time to understand them.</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-22_195e8e4cb65df13d0d1f526398d8ae1a">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join the two data frames, keeping all columns and entries from both data frames</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>data_combined <span class="ot">&lt;-</span> data_usa_clean <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(data_aut_clean) </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
   year sex   name      n      prop country n_total
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
1  1984 F     Kim     387 0.000215  USA          NA
2  1984 M     Kim      92 0.0000490 USA          NA
3  1985 F     Kim     348 0.000189  USA          NA
4  1985 M     Kim      92 0.0000478 USA          NA
5  1986 F     Kim     281 0.000152  USA          NA
6  1986 M     Kim      81 0.0000422 USA          NA</code></pre>
</div>
</div>
<ul>
<li>To see data points from both countries, you could sort values by year using <code>arrange()</code>.</li>
<li>In addition, lets transform the columns sex and country into categorical variables (factors).</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-23_d6f3ef962278e5a5be54c8f35f4991e2">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>data_combined <span class="ot">&lt;-</span> data_usa_clean <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># join the two data frames</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(data_aut_clean) <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sort by year</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year)<span class="sc">%&gt;%</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform sex into a factor</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">factor</span>(sex)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform country into a factor with 2 levels:</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">factor</span>(country))</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
   year sex   name      n      prop country n_total
  &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt;
1  1984 F     Kim     387 0.000215  USA          NA
2  1984 M     Kim      92 0.0000490 USA          NA
3  1984 F     Kim       1 0.0000119 Austria   83856
4  1984 M     Kim       2 0.0000239 Austria   83856
5  1985 F     Kim     348 0.000189  USA          NA
6  1985 M     Kim      92 0.0000478 USA          NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      year      sex        name                 n               prop          
 Min.   :1984   F:68   Length:127         Min.   :  1.00   Min.   :3.210e-06  
 1st Qu.:1993   M:59   Class :character   1st Qu.:  7.00   1st Qu.:1.510e-05  
 Median :2001          Mode  :character   Median : 18.00   Median :3.701e-05  
 Mean   :2001                             Mean   : 50.66   Mean   :7.947e-05  
 3rd Qu.:2009                             3rd Qu.: 70.50   3rd Qu.:1.295e-04  
 Max.   :2017                             Max.   :387.00   Max.   :3.562e-04  
                                                                              
    country      n_total     
 Austria:59   Min.   :64431  
 USA    :68   1st Qu.:67375  
              Median :76058  
              Mean   :74895  
              3rd Qu.:82366  
              Max.   :85333  
              NA's   :68     </code></pre>
</div>
</div>
<p>You might want to drop the column n_total, which only has values for Austria. You can do this with <code>select()</code>:</p>
<ul>
<li>It selects the columns you list.</li>
<li>if you add a minus, it deletes the columns you list</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-24_4e3f9da494b59f9f583c5fd39295c9a9">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>data_combined <span class="ot">&lt;-</span> data_usa_clean <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># join the two data frames</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(data_aut_clean) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sort by year</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year)<span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform sex into a factor</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">factor</span>(sex)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform country into a factor with 2 levels:</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">factor</span>(country)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># delete the column n_total</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n_total) <span class="co">#to delete multiple columns: -c("column_1", "column_2")</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>data_combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 127 × 6
    year sex   name      n      prop country
   &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;  
 1  1984 F     Kim     387 0.000215  USA    
 2  1984 M     Kim      92 0.0000490 USA    
 3  1984 F     Kim       1 0.0000119 Austria
 4  1984 M     Kim       2 0.0000239 Austria
 5  1985 F     Kim     348 0.000189  USA    
 6  1985 M     Kim      92 0.0000478 USA    
 7  1985 F     Kim       3 0.0000364 Austria
 8  1986 F     Kim     281 0.000152  USA    
 9  1986 M     Kim      81 0.0000422 USA    
10  1986 F     Kim       6 0.0000731 Austria
# ℹ 117 more rows</code></pre>
</div>
</div>
</section>
<section id="figures-script" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="figures-script"><span class="header-section-number">6</span> Figures script</h2>
<div class="cell" data-hash="Lesson3b_cache/html/pet-plot_73a31ee4dab73b9b593474cb71dd07f0">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_combined, <span class="fu">aes</span>(country, prop, <span class="at">fill =</span> sex)) <span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"dodgerblue"</span>)) <span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Country"</span>, <span class="at">y =</span> <span class="st">"Proportion"</span>) <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">family =</span> <span class="st">"Times"</span>))<span class="sc">+</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Popularity of the name </span><span class="sc">\"</span><span class="st">Kim</span><span class="sc">\"</span><span class="st"> by country and sex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson3b_files/figure-html/pet-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 1. Scores by pet type and country.</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>In both countries, there are more women than men with the name Kim (main effect of sex).</li>
<li>There is also a main effect of country: in the USA, the name “Kim” is less popular than in Austria.</li>
<li>In addition, there is an interaction: The difference in women named “Kim” between the two countries is larger than the difference for men.</li>
</ul>
</section>
<section id="statistics-script" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="statistics-script"><span class="header-section-number">7</span> Statistics script</h2>
<p>Create a new script, and save it in your code folder for example as <code>03_statistics</code>. At the top of the script, read in the data from the cleaning script using the function <code>source()</code> as we did in lesson 3.</p>
<section id="t-test-by-country" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="t-test-by-country"><span class="header-section-number">7.1</span> T-test by country</h3>
<p>Is your name more popular in Austria or the USA? Although this data is not normally distributed, I want to show you how to do a t-test:</p>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-25_9f541d809351171f471eb4ff7be3144f">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># t-test between countries</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(prop <span class="sc">~</span> country, <span class="at">data =</span> data_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  prop by country
t = 5.0499, df = 76.579, p-value = 2.914e-06
alternative hypothesis: true difference in means between group Austria and group USA is not equal to 0
95 percent confidence interval:
 4.558866e-05 1.049556e-04
sample estimates:
mean in group Austria     mean in group USA 
         1.197764e-04          4.450426e-05 </code></pre>
</div>
</div>
<ul>
<li>You can see that “Kim” is significantly more popular in Austria compared to the US.</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-26_f4f1579d32928919f8f5331a1d84c786">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># t-test between men and women</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(prop <span class="sc">~</span> sex, <span class="at">data =</span> data_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  prop by sex
t = 9.6265, df = 71.905, p-value = 1.458e-14
alternative hypothesis: true difference in means between group F and group M is not equal to 0
95 percent confidence interval:
 8.733425e-05 1.329523e-04
sample estimates:
mean in group F mean in group M 
   1.306421e-04    2.049884e-05 </code></pre>
</div>
</div>
<ul>
<li>You can see that “Kim” is much more frequent in women than men.</li>
</ul>
</section>
<section id="multi-factorial-anova-difference-in-name-popularity-by-sex-and-country" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="multi-factorial-anova-difference-in-name-popularity-by-sex-and-country"><span class="header-section-number">7.2</span> Multi-factorial ANOVA: Difference in name popularity by sex and country</h3>
<p>If you want to investigate if your name is more popular for men or women, and if this difference varies across countries, you could run an ANOVA (analysis of variance) with two factors (sex and country).</p>
<p>I recommend using the package “ez” for this. Load it at the top of your statistics script.</p>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-27_d4c41730e36d60a3933474f1a08b6f6b">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install in the console</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"ez"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># In your script: </span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ez)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After your other analyses (the linear regression and t-test), you can now add the ANOVA in your statistics script, using the function <code>ezANOVA()</code>. It’s arguments:</p>
<ul>
<li><p>the data frame</p></li>
<li><p>dv: the dependent variable (propotion)</p></li>
<li><p>wid: the columns that identify unique rows in your data frame</p></li>
<li><p>Type 3 defines which sum of squares are calculated for the ANOVA. This is detailed statistics knowledge, and only slightly changes your result. In any case, SPSS by default gives you type 3, so we use it here.</p></li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-28_3b6f248bf7669c4be4097c53c9719de0">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>country_sex.aov <span class="ot">=</span> <span class="fu">ezANOVA</span>(<span class="at">data =</span> data_combined,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">dv =</span> prop, </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">wid =</span> .(<span class="st">"year"</span>, <span class="st">"name"</span>),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># predictors</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">between =</span> .(<span class="st">"country"</span>, <span class="st">"sex"</span>),</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="dv">3</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>country_sex.aov</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$ANOVA
       Effect DFn DFd         F            p p&lt;.05       ges
2     country   1 123  42.13132 1.886914e-09     * 0.2551383
3         sex   1 123 127.77207 9.391571e-21     * 0.5095148
4 country:sex   1 123  30.59984 1.817898e-07     * 0.1992179

$`Levene's Test for Homogeneity of Variance`
  DFn DFd          SSn          SSd        F           p p&lt;.05
1   3 123 6.930065e-08 1.709389e-07 16.62188 3.96263e-09     *</code></pre>
</div>
</div>
</section>
<section id="make-a-table-with-statistics-and-export-it-to-a-csv-file" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="make-a-table-with-statistics-and-export-it-to-a-csv-file"><span class="header-section-number">7.3</span> Make a table with statistics and export it to a csv-file:</h3>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-29_d22eceba2a8bf06822539e2073b2b596">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> data_combined <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, sex) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate mean and standard deviation</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_proportion =</span> <span class="fu">mean</span>(prop), </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_proportion =</span> <span class="fu">sd</span>(prop), </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># transform to percent for readibility</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_percent =</span> mean_proportion<span class="sc">*</span><span class="dv">100</span>, </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_percent =</span> sd_proportion<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># print</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>summary_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  country sex       n mean_proportion sd_proportion mean_percent sd_percent
  &lt;fct&gt;   &lt;fct&gt; &lt;int&gt;           &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1 Austria F        34       0.000189      0.0000894      0.0189     0.00894
2 Austria M        25       0.0000259     0.0000180      0.00259    0.00180
3 USA     F        34       0.0000724     0.0000496      0.00724    0.00496
4 USA     M        34       0.0000166     0.0000145      0.00166    0.00145</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To write results to an excel table, in order to include tables into papers, for example: </span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(summary_table, <span class="st">'write_up/descriptives_table.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="transforming-data-from-long-to-wide-format" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="transforming-data-from-long-to-wide-format"><span class="header-section-number">8</span> Transforming data from long to wide format</h2>
<p>Sometimes (although not in the analyses above) you need your data in a wide format, that is, multiple columns for the dependent variable, as here separate columns for Austria and the US and this for each sex.</p>
<ul>
<li>SPSS and other statistics software need data in this format by default.</li>
<li>In R, you can change the format of the data frame using the function <code>pivot_wider()</code> from the tidyverse package <code>tidyr</code>.</li>
<li>Install the package, and load the library at the start of your statistics script.</li>
<li>Arguments of pivot_wider():
<ul>
<li>the data frame</li>
<li>id_cols: the column or columns that identify a single unique row in your data frame. This could by you participant ID. Here, it is each name per year.</li>
<li>names_from: the variables for which you want to create new columns (or column/variable names)</li>
<li>values_from: the value/variable you want to fill these columns with, here proportion (log transformed)</li>
</ul></li>
<li>Write the following code in your section for organizing data in the statistics script.</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-30_ab6d2f4ab57fa7ced40216dd3fc3d304">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ORGANIZE DATA ####</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame in wide format</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>data_combined_wide <span class="ot">=</span> tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(data_combined, </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"name"</span>), </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">names_from =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"sex"</span>), </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">values_from =</span> <span class="st">"prop"</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_combined_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
   year name     USA_F     USA_M Austria_F  Austria_M
  &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1  1984 Kim   0.000215 0.0000490 0.0000119  0.0000239
2  1985 Kim   0.000189 0.0000478 0.0000364 NA        
3  1986 Kim   0.000152 0.0000422 0.0000731 NA        
4  1987 Kim   0.000149 0.0000390 0.0000246 NA        
5  1988 Kim   0.000131 0.0000445 0.0000848 NA        
6  1989 Kim   0.000130 0.0000344 0.000182   0.0000727</code></pre>
</div>
</div>
<ul>
<li>This will create an extra column per country and gender (4 columns in total)</li>
<li>The function that transforms data frames in the reverse direction, is called <code>pivot_longer()</code>. Try to back transform your wide data frame to a long one as an exercise!</li>
</ul>
<p>You can see that the wide data frame has empty values (NA = not available) for men in the USA. our pivot_wider call added a row for each year where the name Kim occurred in any country or sex, this is why cells with no data for Kim now have an NA.You could also check how many NAs are in the column with the line of code below.</p>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-31_b4f7cd6c9a25b5acfeaa66fbebe9f236">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># are there any missing values? How many?</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(data_combined_wide<span class="sc">$</span>Austria_M))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9</code></pre>
</div>
</div>
<p>We actually know that in this case, NA simply means there were no babies with that name. So let’s replace the NAs with 0 using <code>ifelse()</code>. It’s arguments:</p>
<ul>
<li>The condition for <code>if</code> is that Austria_M is an <code>NA</code>, you can check this with the function <code>is.na()</code> which will give TRUE for missing values (NAs).</li>
<li>if this condition is met (TRUE), then replace with a 0</li>
<li>else, keep the value of Austria_M.</li>
</ul>
<div class="cell" data-hash="Lesson3b_cache/html/unnamed-chunk-32_aa451c2a565a6cbb3a166c64aa32d6c4">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>data_combined_wide <span class="ot">=</span> data_combined_wide <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># replace NAs with zero</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Austria_M =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Austria_M), <span class="dv">0</span>, Austria_M))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>data_combined_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 34 × 6
    year name      USA_F     USA_M Austria_F Austria_M
   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1  1984 Kim   0.000215  0.0000490 0.0000119 0.0000239
 2  1985 Kim   0.000189  0.0000478 0.0000364 0        
 3  1986 Kim   0.000152  0.0000422 0.0000731 0        
 4  1987 Kim   0.000149  0.0000390 0.0000246 0        
 5  1988 Kim   0.000131  0.0000445 0.0000848 0        
 6  1989 Kim   0.000130  0.0000344 0.000182  0.0000727
 7  1990 Kim   0.000125  0.0000307 0.000144  0.0000120
 8  1991 Kim   0.000102  0.0000283 0.000235  0        
 9  1992 Kim   0.0000908 0.0000214 0.000241  0.0000120
10  1993 Kim   0.0000938 0.0000189 0.000208  0        
# ℹ 24 more rows</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>