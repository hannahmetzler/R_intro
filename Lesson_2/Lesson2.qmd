---
title: "Lesson 2: Reproducible workflows with Quarto & GitHub"
subtitle: "Course website: https://hannahmetzler.eu/R_intro/"
author: "Hannah Metzler"
date: "March 6 2023"
format: 
  html:
    toc: true # generate a table of content
    number-sections: true
    df-print: kable
editor: visual
cache: true
execute: 
  warning: false
echo: true
---

## Quick repetition of Lesson 1

- Assigning numeric values or strings to objects, then using the objects:

```{r}
x <- 5
y <- "string"
x*2
print(y)
```

- Using whitespaces to organize your code
- Removing objects in the environment

```{r}
rm(list = ls())
```

- Functions & arguments

```{r}
rnorm(20, mean = 100, sd = 10)
```

- Function help

```{r}
?rnorm
```

- Installing & loading packages
```{r}
# install.packages("tidyverse")
library(tidyverse)
```

## Goals for lesson 2

- Commit to Git
- Push to GitHub
- Organize a project (folder, files, R-project)
- Read in & manipulate data
- Make a figure & save it to PDF
- Create a Quarto document


## File system and names

Before we create our first R-project, we need to talk about how to name files and folders, and how the file system and file paths on your PC work, and how you navigate your way through it.

### File and folder names

- Use names that work well for computers & people
- No spaces
-   be consistent with capitalisation (set a rule to make it easy to remember, like always use lowercase)
- A full stop only before the file extension `data_file.csv`
-   use underscores (`_`) to separate parts of the file name, and dashes (`-`) to separate words in a section `"data_questionnaire_2021-11-15.xls"`
-   prefix a file name with an underscore to move it to the top of the list, or prefix all files with numbers to control their order
-   use YYYY-MM-DD format for dates so they sort in chronological order

#### Bad examples

-   `Data (Participants) 11-15.xls`
-   `final report2.doc`
-   `Participants Data Nov 12.xls`
-   `project notes.txt`
-   `Questionnaire Data November 15.xls`
-   `report final.doc`
-   `report final 2.doc`

#### Good examples

-   `_project-notes.txt`
-   `data_participants_2021-11-12.xls`
-   `data_participants_2021-11-15.xls`
-   `report_v1.doc`
-   `report_v2.doc`
-   `report_v3.doc`

### File system & paths

- Your user accounts' main directory: `/Users/UserName/`
    - `~` shortcut for it
- A file on your Desktop: `/Users/UserName/Desktop/datafile.csv`
  - Using the shortcut `~/Desktop/datafile.csv`
- I find it useful to have all my analysis projects in a common folder directly in my user folder: `~/AnalysisProjects/`
- You can navigate to directory's via the Terminal (Shell, Console) using commands like:
  - `cd` change directory
  - `..` move one directory upwards
  - `/` to divide subfolders: `directory/subdirectory/`
- You can access the Terminal from within R-studio (next to the Console). 

```{r, echo = FALSE}
knitr::include_graphics('images/Terminal_in_Rstudio.png')
```



:::{.callout-caution}
#### Exercise
What is the file path for an imaginary `file.csv` in your Documents folder?
:::

### Working Directory

- Folder of the project you are currently working on
- Never change working directory in a script
- Your scripts should only reference three types of locations: 

| Where | Example |
|-------|---------|
| on the web               | "https://hannahmetzler.eu/R_intro/Lesson_2/data/datafile.csv" |
| in the working directory | "datafile.csv" |
| in a subdirectory        | "data/datafile.csv" |

- Typing `pwd` (print working directory) in the Terminal shows you the directory you are currently in. 

:::{.callout-caution}
#### Exercise
- In Rstudio, go to the `Terminal` 
- Check which directory you are in
- Navigate to your user directory
- Move back up one folder 
- Move back to your user directory using the shortcut
:::

## Git & GitHub

- Backup, version control & collaboration
- Did setup work for all of you?
- We cover the absolute basics here, for more: <http://happygitwithr.com/>
- Committing: creating a named version on your PC
- Pushing: Uploading to GitHub

```{r echo=FALSE}
knitr::include_graphics('../Lesson_1/images/how_git_works.svg')
```

We will now create a remote repository on Github, copy it to our local PCs, and then continue Lesson 2 in that local repository (=directory/folder). 

### Create a remote git repository

- On <https://github.com/> click on `New` on the top left.
- As shown in the screenshot below: 
  - Name the repository
  - Make it private
  - Add a README file
  - Choose the template R for the .gitignore file
  - (No License needed)
  - Click `Create repository`: 

```{r echo=FALSE}
knitr::include_graphics('images/create_repo.png')
```

- `README.md`: where you describe the project (folder structure, content, etc.)
- `.gitignore`: Hidden file that tells Git what not to upload to GitHub (e.g., figures)

### Clone the remote Git Repository to your laptop

1. Copy the SSH link of your repository (for connecting it to Rstudio):

```{r echo=FALSE}
knitr::include_graphics('images/copy_SSH_repo_link.png')
```

2. In Rstudio, in the Terminal:
  - Navigate to the directory where you want the R_introduction folder using `cd`. (I want it in my folder `AnalysisProjects`)
  - `git clone` and paste your repository link: 

```{r echo=FALSE}
knitr::include_graphics('images/git_clone.png')
```

There is now a folder with the name of the remote repository in the directory you "cloned" it to. (For me, in the `AnalysisProjects/` folder.) In that folder, let's start our first R-project! 

## Organize your project

### R-projects

- Useful to organize your coding projects
- Group all files of a project in a directory
- Allows using Git for version control
- R-project automatically sets working directory to the R-project folder
- In the top right corner in Rstudio, you can see that we are not currently in any project. 
- Let's create a project for today's lesson:  

::: {.callout-caution}
#### Exercise
1.   Open a New Project in Rstudio: Choose `Create a project...` under the `File` menu. 
```{r, echo=FALSE}
knitr::include_graphics('images/create_project.png')
```
2. Choose `Existing Directory`
3. Use `Browse` to navigate to our folder `R_intro_lesson_2` and click `Create Project`
```{r, echo=FALSE}
knitr::include_graphics('images/new_project.png')
```
:::

From now on, you can double click this Rproject file in your `R_intro_lesson2` folder to directly open Rstudio in this folder. 

### Folder structure

```{r, echo=FALSE}
#| fig-width: 2
knitr::include_graphics('images/folder_structure.png')
```

-   Alternative/additional folder names could be: 
    - tables
    - reports
    - output (tables, reports, ...)
    - raw_data: I recommend having a separate folder for the raw data
    - code = scripts
-   Plus any other project specific folders

::: {.callout-caution}
#### To do
Create these subfolders:

  -   data
  -   code
  -   figures
  -   write_up
  
Download this [text file](https://hannahmetzler.eu/R_intro/Lesson_2/data/rintro_lesson2_data.txt) from the course website. It is our data file for Lesson 2.  
:::

### Commit to Git

We can now back up the project and data to a "remote repository" on GitHub. 

1. Click on **Git** in the upper right pane. 
2. You see 2 files to commit: 

```{r echo=FALSE}
knitr::include_graphics('images/files_for_commit.png')
```

3. Add them to git by checking the box

```{r echo=FALSE}
knitr::include_graphics('images/add_commit_files.png')
```

4. Click commit
5. Write a commit message (describe what the commit contains)

```{r echo=FALSE}
knitr::include_graphics('images/commit_message.png')
```

6. Click Commit again, then Close.

### Upload to GitHub

- Click **Push**. 
- Go to your remote repository on GitHub. Do you see the folder and files you added?

## Scripts & Quarto Documents

Different file types you can create: 
```{r,results=FALSE}
knitr::include_graphics('images/script_types.png')
```

- R script: only code (comments in lines starting with #)
- Quarto Document allows to: 
  - Combine text and code
  - Print out results of the code (figures etc) to pdf, html, doc, slides...
  - Useful to have automated reports about your results

:::{.callout-tip}
Use Quarto Documents to lead through the analyses. From it, you can call other scripts in the `code` folder, in the order required for the analysis (e.g., a cleaning script, a figures script, etc.). 
:::



## Read in and manipulate data

We will finally start coding! 

- Open an R-script.  
- At the top of each script: load required packages. 
- Lines with # are comments, so R does not read them as code. 
- Lines ending with #### are code blocks, that can be opened and closed. Use them to organize your script! 

```{r, results = FALSE}
## LOAD PACKAGES ####
library(dplyr) #for data manipulation
library(ggplot2) #for figures
```

- Now, read in the text file from the data folder.
- `header = TRUE` tells R that there is a first line with column names. 
- `sep = "\t"` indicates that cells in the file are separated with a tab (this could also be `,` or `;`). 

```{r, results=FALSE}
## READ IN DATA AND ORGANIZE ####
# Read in data
data = read.table("data/rintro_lesson2_data.txt", header = TRUE, sep = "\t")
```

Now, lets' look at the data. 

```{r, results=FALSE}
# Look at data
dim(data) # dimensions
head(data) # first rows
tail(data) # last rows
xtabs(~group, data) # how many entries per group?
```

```{r, results=FALSE}
# Subset out bilinguals
data_bl = data %>%
          filter(group == "bilingual") 
```


```{r, results=FALSE}
# Look at bilingual data
dim(data_bl)
head(data_bl)
tail(data_bl)
xtabs(~group, data_bl)
xtabs(~type, data_bl) 
```

- Save your script in the code folder: `rintro_lesson2`

## Make a figure

```{r}
## MAKE FIGURES ####
# By group
data.plot = ggplot(data, aes(x = group, y = rt)) +
            geom_boxplot()
data.plot 
```



## To cover: 
-   Including a code junk
-   Quarto basics

- Commit it to Git: Click **Git**, then Commit
- Choose all files (use Shift to check all at once)
- In the Commit message window, write "read data, made figure", click Commit.
- Close, and Push. 


## References

This lesson is based on: 
- Page Piccinini, R-Course, [Lesson 1: R Basics](https://pagepiccinini.com/r-course/lesson-1-r-basics/). 
- Chapter 2 of: Lisa DeBruine & Dale Barr. (2022). [Data Skills for Reproducible Research](https://psyteachr.github.io/reprores-v3/intro.html): (3.0) Zenodo. doi:10.5281/zenodo.6527194. 

