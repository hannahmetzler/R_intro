<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hannah Metzler">
<meta name="dcterms.date" content="2024-03-20">

<title>Lesson 3:</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Lesson3_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lesson3_files/libs/quarto-html/quarto.js"></script>
<script src="Lesson3_files/libs/quarto-html/popper.min.js"></script>
<script src="Lesson3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Lesson3_files/libs/quarto-html/anchor.min.js"></script>
<link href="Lesson3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lesson3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Lesson3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Lesson3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Lesson3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#goals" id="toc-goals" class="nav-link active" data-scroll-target="#goals"><span class="header-section-number">1</span> Goals</a></li>
  <li><a href="#set-up-your-work-space" id="toc-set-up-your-work-space" class="nav-link" data-scroll-target="#set-up-your-work-space"><span class="header-section-number">2</span> Set up your work space</a></li>
  <li><a href="#analysis-project-for-lesson-3" id="toc-analysis-project-for-lesson-3" class="nav-link" data-scroll-target="#analysis-project-for-lesson-3"><span class="header-section-number">3</span> Analysis project for Lesson 3</a></li>
  <li><a href="#organizing-your-scripts" id="toc-organizing-your-scripts" class="nav-link" data-scroll-target="#organizing-your-scripts"><span class="header-section-number">4</span> Organizing your scripts</a></li>
  <li><a href="#cleaning-script" id="toc-cleaning-script" class="nav-link" data-scroll-target="#cleaning-script"><span class="header-section-number">5</span> Cleaning script</a></li>
  <li><a href="#figures-script" id="toc-figures-script" class="nav-link" data-scroll-target="#figures-script"><span class="header-section-number">6</span> Figures Script</a>
  <ul class="collapse">
  <li><a href="#checking-for-normal-distribution-histogram" id="toc-checking-for-normal-distribution-histogram" class="nav-link" data-scroll-target="#checking-for-normal-distribution-histogram"><span class="header-section-number">6.1</span> Checking for normal distribution: Histogram</a></li>
  <li><a href="#continuous-predictor-scatter-plot" id="toc-continuous-predictor-scatter-plot" class="nav-link" data-scroll-target="#continuous-predictor-scatter-plot"><span class="header-section-number">6.2</span> Continuous predictor: Scatter plot</a></li>
  <li><a href="#categorical-predictor-boxplot" id="toc-categorical-predictor-boxplot" class="nav-link" data-scroll-target="#categorical-predictor-boxplot"><span class="header-section-number">6.3</span> Categorical predictor: Boxplot</a></li>
  </ul></li>
  <li><a href="#math-of-linear-regression" id="toc-math-of-linear-regression" class="nav-link" data-scroll-target="#math-of-linear-regression"><span class="header-section-number">7</span> Math of linear regression</a>
  <ul class="collapse">
  <li><a href="#continuous-predictor" id="toc-continuous-predictor" class="nav-link" data-scroll-target="#continuous-predictor"><span class="header-section-number">7.1</span> Continuous predictor</a></li>
  <li><a href="#categorical-predictor" id="toc-categorical-predictor" class="nav-link" data-scroll-target="#categorical-predictor"><span class="header-section-number">7.2</span> Categorical predictor</a></li>
  </ul></li>
  <li><a href="#statistics-script-linear-regression" id="toc-statistics-script-linear-regression" class="nav-link" data-scroll-target="#statistics-script-linear-regression"><span class="header-section-number">8</span> Statistics script: Linear regression</a>
  <ul class="collapse">
  <li><a href="#continuous-predictor-year" id="toc-continuous-predictor-year" class="nav-link" data-scroll-target="#continuous-predictor-year"><span class="header-section-number">8.1</span> Continuous predictor: Year</a></li>
  <li><a href="#categorical-predictor-sex" id="toc-categorical-predictor-sex" class="nav-link" data-scroll-target="#categorical-predictor-sex"><span class="header-section-number">8.2</span> Categorical predictor: Sex</a></li>
  </ul></li>
  <li><a href="#write-up-quarto-report" id="toc-write-up-quarto-report" class="nav-link" data-scroll-target="#write-up-quarto-report"><span class="header-section-number">9</span> Write up: Quarto Report</a></li>
  <li><a href="#references-resources" id="toc-references-resources" class="nav-link" data-scroll-target="#references-resources"><span class="header-section-number">10</span> References &amp; Resources</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lesson 3:</h1>
<p class="subtitle lead">Course website: https://hannahmetzler.eu/R_intro/</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hannah Metzler </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 20, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="goals" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="goals"><span class="header-section-number">1</span> Goals</h2>
<ul>
<li>Repeat setting up your work space with R-Projects, Git &amp; GitHub</li>
<li>Clean data using dplyr (<code>filter</code> and <code>mutate</code>)</li>
<li>Make a histogram, scatter plot, and box plot</li>
<li>Repeat the math behind linear regression</li>
<li>Run a linear regression</li>
<li>Summarise results in a Quarto Document</li>
</ul>
</section>
<section id="set-up-your-work-space" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="set-up-your-work-space"><span class="header-section-number">2</span> Set up your work space</h2>
<ol type="1">
<li>Make a remote git repository on GitHub (e.g.&nbsp;“rintro_lesson3”)</li>
<li>Copy the SSH Link</li>
<li>In the Terminal, navigate to your folder for this R course using <code>cd</code>.</li>
<li>Type <code>git clone</code> and paste your SSH link.</li>
<li>In the now local folder of the repository, create sub folders (e.g.&nbsp;“data”, “figures”, “code”, “write_up”).</li>
<li>Put the <a href="https://github.com/hannahmetzler/R_intro_lesson3/blob/main/data/rcourse_lesson2_data.txt">data file</a> for this lesson in your “data” folder.</li>
<li>Make a new R Project based in your main directory folder (e.g.&nbsp;“rintro_lesson3”).</li>
<li>Commit &amp; Push to GitHub.</li>
</ol>
</section>
<section id="analysis-project-for-lesson-3" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="analysis-project-for-lesson-3"><span class="header-section-number">3</span> Analysis project for Lesson 3</h2>
<p>Data from the USA Social Security Administration on baby names</p>
<p><strong>2 research questions:</strong></p>
<ol type="1">
<li>Continuous Predictor: Does the name “Page” get more or less popular between the years of 1901 and 2000?</li>
<li>Categorical Predictor: Is the name “Page” more or less popular with females or males?</li>
</ol>
</section>
<section id="organizing-your-scripts" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="organizing-your-scripts"><span class="header-section-number">4</span> Organizing your scripts</h2>
<ul>
<li>Separate scripts for each step can be useful, we will use this structure today:
<ul>
<li>cleaning</li>
<li>figures</li>
<li>statistics</li>
</ul></li>
<li>Alternatively, these can be sections in a Quarto Document.</li>
</ul>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
To do
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a script and save it in the <code>code</code> folder as <code>01_cleaning.R</code>.</p>
</div>
</div>
</section>
<section id="cleaning-script" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="cleaning-script"><span class="header-section-number">5</span> Cleaning script</h2>
<ul>
<li>Start again with a header (# TITLE ####) for loading packages.</li>
<li>We only need the package <code>dplyr</code> for now.</li>
<li>Shortcut to run a line of code from a script: <code>Ctrl/Strg/Cmd + Enter</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## LOAD PACKAGES ####</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Next, we read in data, with the same function as last time but for .txt files.</li>
<li>The argument col_types defines what kind of variables.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(<span class="st">"data/lesson2_data_babynames.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To check if the file was read correctly you can use <code>head(data)</code> in the Console.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">sex</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">prop</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Caroline</td>
<td style="text-align: right;">306</td>
<td style="text-align: right;">0.0031351</td>
</tr>
<tr class="even">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Hannah</td>
<td style="text-align: right;">221</td>
<td style="text-align: right;">0.0022642</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Helena</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">0.0006147</td>
</tr>
<tr class="even">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Teresa</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0.0005123</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Claudia</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">0.0004918</td>
</tr>
<tr class="even">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Magdalena</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.0001947</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<ul>
<li>Check if your own name exists in the dataset using the function <code>filter()</code>:
<ul>
<li>Check the function in the help: <code>?dplyr::filter</code> (Description, Usage &amp; Examples).
<ul>
<li>The first argument is for the dataframe.</li>
<li>The second argument (<code>...</code>) is for the expression that defines our condition for rows we want to keep.</li>
<li>The Examples section shows you how to use the function.</li>
</ul></li>
</ul></li>
<li>I’ll be using the name “Page” - in honor of the colleague who taught me R with exactly this same data set.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data_clean <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(data, name <span class="sc">==</span> <span class="st">"Page"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check if it worked, for example using <code>head()</code> on the new data frame</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">sex</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">prop</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1881</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">Page</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4.62e-05</td>
</tr>
<tr class="even">
<td style="text-align: right;">1887</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">Page</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4.57e-05</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1888</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">Page</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3.85e-05</td>
</tr>
<tr class="even">
<td style="text-align: right;">1890</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Page</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2.48e-05</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1891</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">Page</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4.58e-05</td>
</tr>
<tr class="even">
<td style="text-align: right;">1892</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;">Page</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">6.85e-05</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>If this is empty, your name does not exist in the US names data set. Simply stay with the name “Page”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(data, name <span class="sc">==</span> <span class="st">"Lav"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/empty_tibble.jpg" class="img-fluid figure-img" width="306"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Now, we’ll use the same code to assign only rows with your name to the data frame <code>data_clean</code>.</li>
<li>We want to be able to run more functions to clean the data. We can do this using the <strong>Pipe (%&gt;%)</strong> after data. <code>filter()</code> will then be run on <code>data</code> before assigning to <code>data_clean</code>.
<ul>
<li>Shortcut: <code>Shift + Ctrl/Cmd + M</code></li>
</ul></li>
<li>Copy and run the code below.</li>
<li>To use something different, I check if it worked with <code>xtabs()</code> this time.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## CLEAN DATA ####</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>data_clean <span class="ot">=</span> data <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Page"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span>name, data_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>name
Page 
 206 </code></pre>
</div>
</div>
<p>We only want to look at the 20th century, so we filter out the years between 1900 and 2000 using the <code>filter()</code> function:</p>
<ul>
<li>The first new filter call selects all years after 1900, the second all years up to and including 2000.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data_clean <span class="ot">=</span> data <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Page"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1900</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To confirm this worked, we can check the minimum and maximum year in the new data frame. For the name “Page”, this shows the first year in which it was given to a baby was 1909.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(data_clean<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1909</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(data_clean<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2000</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
To do
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Save the cleaning script.</li>
<li>Commit the changes to Git. The commit message could be “Made cleaning script”.</li>
<li>Open a new script <code>02_figures.R</code></li>
</ul>
</div>
</div>
</section>
<section id="figures-script" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="figures-script"><span class="header-section-number">6</span> Figures Script</h2>
<p>We’ll learn a new function now: <code>source()</code> tells R to run another script.</p>
<ul>
<li>We can use it to run the cleaning script from our figures script, to read in our clean data.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## READ IN DATA ####</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"code/01_cleaning.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Enter the exact path and name of your script.</li>
<li>To be sure it works, first delete all objects from the <strong>Environment</strong> (broom symbol or <code>rm(list = ls)</code>)</li>
</ul>
<p>All variables should now reappear in your Environment:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/source_environment.png" class="img-fluid figure-img" width="290"></p>
</figure>
</div>
</div>
</div>
<p>Now load all packages not yet loaded in the cleaning script. We need ggplot2 to make a figure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## LOAD PACKAGES ####</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We may want to change names or levels of variables a bit for our figures. It’s good to create an extra data set for this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ORGANIZE DATA ####</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>data_figs <span class="ot">=</span> data_clean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="checking-for-normal-distribution-histogram" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="checking-for-normal-distribution-histogram"><span class="header-section-number">6.1</span> Checking for normal distribution: Histogram</h3>
<p>To run a linear regression, our dependent variable needs to be normally distributed. A perfect normal distribution is symmetrical, for example, here 2 distributions with n = 1 million observations:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>With less observations, the shape will be less perfect, but still roughly symmetrical (n = 100) with most values around the mean:</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s check the distribution of our dependent variable with a histogram:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## MAKE FIGURES ####</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of dependent variable (proportion of 'Page's)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>name.plot <span class="ot">=</span> <span class="fu">ggplot</span>(data_figs, <span class="fu">aes</span>(<span class="at">x =</span> prop)) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_histogram</span>()</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>name.plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Proportion of babies with the name “Page” is clearly not normally distributed.</li>
<li>Note that aes() only needs an x-variable for histograms, because we plot only one variable.</li>
<li>Information message about bins: R picks one by default, but notifies you that you can enter a better one, as the binwidth can really change the shape of a distribution.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram with specific binwidth</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_figs, <span class="fu">aes</span>(<span class="at">x =</span> prop)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.0000005</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>One usual way of making data normal is a log transformation. In R, you can take the logarithm with base 10 with <code>log10()</code>.</li>
<li>Go back to the cleaning script to do the log transform. To make any transformation to a variable, we can use <code>mutate()</code> from dplyr. <code>mutate()</code> is used to make a new column or change an existing one.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>data_clean <span class="ot">=</span> data <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Page"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1900</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_log10 =</span> <span class="fu">log10</span>(prop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Run this code block, or save the script and rerun <code>source()</code> in the figures script.</li>
<li>Back in the figures script, rerun the line to make the “data_figs” data frame.</li>
<li>Now let’s have a look at the distribution again:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of log transformed dependent variable (proportion of 'Page's)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>name_log10.plot <span class="ot">=</span> <span class="fu">ggplot</span>(data_figs, <span class="fu">aes</span>(<span class="at">x =</span> prop_log10)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_histogram</span>()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>name_log10.plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<p>This distribution is more or less normal. We can go ahead and focus on figures for the regression.</p>
</section>
<section id="continuous-predictor-scatter-plot" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="continuous-predictor-scatter-plot"><span class="header-section-number">6.2</span> Continuous predictor: Scatter plot</h3>
<p>Our first research question was: How did the popularity of the name, “Page” change over time?</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Which 2 variables do we need to plot to look at this?</li>
</ul>
</div>
</div>
<ul>
<li>To make a scatter plot we use <code>geom_point()</code>.</li>
<li>To add a regression line we use <code>geom_smooth()</code> with the method set to <code>lm</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of 'Page's by year (continuous predictor)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>year.plot <span class="ot">=</span> <span class="fu">ggplot</span>(data_figs, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> prop_log10)) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>year.plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Is there an effect of year on time?</li>
</ul>
</div>
</div>
<ul>
<li><p>To save the figure to a file, you can use <code>ggsave()</code> like in Lesson 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save the plot</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">'figures/scatterplot_proportion_year.pdf'</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="categorical-predictor-boxplot" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="categorical-predictor-boxplot"><span class="header-section-number">6.3</span> Categorical predictor: Boxplot</h3>
<ul>
<li>Now let’s make a figure for the second question: Is there a sex difference in popularity of the name?
<ul>
<li>We will use a box plot for this. Which variable should be on the x and y axis?</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of 'Page's by sex (categorical predictor)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>sex.plot <span class="ot">=</span> <span class="fu">ggplot</span>(data_figs, <span class="fu">aes</span>(<span class="at">x =</span> sex, <span class="at">y =</span> prop_log10)) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_boxplot</span>()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>sex.plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>You might want more explicit labels for “F” and “M” in a figure. We can update the code to create data_figs data frame at the top of our script.</li>
<li>We’ll use <code>mutate()</code> to change the names of the variable levels of the variable sex.</li>
<li>We’ll use <code>factor()</code>, a function to make categorical variables with labels. The arguments we need are:
<ul>
<li>levels: “an optional vector of the unique values (as character strings) that x might have taken” (from Help)</li>
<li>labels: “an optional character vector of labels for the levels”</li>
</ul></li>
<li>What is a vector? A list of items of the same type (e.g., numbers or characters).
<ul>
<li>If you want to assign numbers to a variable, you use a vector in R.</li>
<li>Notation in R: <code>c()</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>my_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>my_character_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"string1"</span>, <span class="st">"string2"</span>, <span class="st">"string3"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>my_vector</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 7 5 3 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>my_character_vector</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "string1" "string2" "string3"</code></pre>
</div>
</div>
<ul>
<li>We use vectors for levels and labels within <code>factor()</code> below.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ORGANIZE DATA ####</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>data_figs <span class="ot">=</span> data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">factor</span>(sex, </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"F"</span>, <span class="st">"M"</span>), </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>If you run the figure code again, you will get this figure:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of 'Page's by sex (categorical predictor)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>sex.plot <span class="ot">=</span> <span class="fu">ggplot</span>(data_figs, <span class="fu">aes</span>(<span class="at">x =</span> sex, <span class="at">y =</span> prop_log10)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_boxplot</span>()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>sex.plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>To save the plot, uncomment (shortcut: <code>Ctrl+Shift+C</code>) and run:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave('figures/boxplot_propotion_by_sex.pdf', dpi = 300)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>To make the figure prettier, there are various elements you can change. Have a look at this at home.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of 'Page's by sex (categorical predictor)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>sex.plot <span class="ot">=</span> <span class="fu">ggplot</span>(data_figs, <span class="fu">aes</span>(<span class="at">x =</span> sex, <span class="at">y =</span> prop_log10, <span class="at">fill=</span>sex))<span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># choose a design</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a title</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Popularity of the name 'Page' by sex"</span>)<span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Customize the y-axis (with a line break)</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Proportion of People</span><span class="sc">\n</span><span class="st">(log base 10 transformed)"</span>)<span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Customize the x-axis</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sex"</span>) <span class="sc">+</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Custom colours for the fill variable (sex)</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"blue"</span>))<span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Additional paramaters for displaying plot</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), <span class="co"># text size</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), <span class="co"># text size for title</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">"none"</span>) <span class="co"># no legend</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>sex.plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to save the plot: </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave('figures/boxplot_propotion_by_sex.pdf', dpi = 300)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>The figure script is done. Save it, commit to Git, and push to GitHub!</p>
</div>
</div>
</section>
</section>
<section id="math-of-linear-regression" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="math-of-linear-regression"><span class="header-section-number">7</span> Math of linear regression</h2>
<p>The basic equation of linear regression is:</p>
<p><strong>y<sub>i</sub> = a + b<sub>i</sub>x + e<sub>i</sub></strong></p>
<ul>
<li>y<sub>i</sub> = a specific y value (dependent variable)</li>
<li>a = intercept (where the regression line crosses the y-axis when x = 0)</li>
<li>b = slope (change in y for one change in x)</li>
<li>x<sub>i</sub> = specific x value (independent variable, predictor)</li>
<li>e<sub>i</sub> = random variance, residual, noise</li>
</ul>
<section id="continuous-predictor" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="continuous-predictor"><span class="header-section-number">7.1</span> Continuous predictor</h3>
<p>Let’s see an example for a continuous predictor: How does the weight of chicks change over time? As more time passes, the weight increases.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/read%20data-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>We can add a line to show the increase:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Let’s pick a specific data point. These are the y and x values for a data point:</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/scatterplot_y_x.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Here, you see a, the intercept: The weight when x = 0 (when chicks are zero days old).</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/scatterplot_intercept.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Here, you see b, the slope: How much weight does a baby chick gain on average on a day? (Change in y, when x changes by 1, here from day 5 to 6)</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/scatterplot_slope.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Here you see the residual for the data point: The difference between model prediction and the actual data:</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/scatterplot_residual.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="categorical-predictor" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="categorical-predictor"><span class="header-section-number">7.2</span> Categorical predictor</h3>
<p>What if x is categorical?</p>
<p><strong>a = bx</strong></p>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 52%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th>–</th>
<th>Continuous Predictor</th>
<th style="text-align: left;">Categorical Predictor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>x</td>
<td>a set of continuous data points</td>
<td style="text-align: left;">a set of binary/categorical data points</td>
</tr>
<tr class="even">
<td>a</td>
<td>the value of y when x is 0</td>
<td style="text-align: left;">the value of y when x is the default level</td>
</tr>
<tr class="odd">
<td>b</td>
<td>the change in y for one change in x</td>
<td style="text-align: left;">the change in y when x is the non-default level</td>
</tr>
</tbody>
</table>
<p>As an example, let’s say chicks get 2 different diets:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>We can look at this as a collection of points:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>We need to change the labels of diets to values: 0 for the default, and 1 for the next level.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lesson3_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>X and y for a specific data point:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/scatterplot_categorical_y_x.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Now we add a line from one mean to the second. The intercept is the value of y when x is the default level (Diet 1). Here slightly above 100.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/scatterplot_categorical_intercept.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The slope is the change in the mean of Diet 1 to Diet 2:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/scatterplot_categorical_slope.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The residual is the difference between the model prediction and the actual data point.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/scatterplot_categorical_residual.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="statistics-script-linear-regression" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="statistics-script-linear-regression"><span class="header-section-number">8</span> Statistics script: Linear regression</h2>
<p>As always, start with a section to read in data, then one to load packages.</p>
<ul>
<li>We don’t need any package at the moment, but you usually want to add some later while doing the analysis.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">## READ IN DATA ####</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"code/01_cleaning.R"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="do">## LOAD PACKAGES #####</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># [none currently needed]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As before, we make a new data frame for statistics data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ORGANIZE DATA ####</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>data_stats <span class="ot">=</span> data_clean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="continuous-predictor-year" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="continuous-predictor-year"><span class="header-section-number">8.1</span> Continuous predictor: Year</h3>
<ul>
<li>The notation for a linear regression in R is: <code>lm (y \~ x)</code></li>
<li>In the chick weight example above, this would be: <code>lm(weight \~ Time)</code></li>
<li>To see the output of the model, we use <code>summary(model)</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## BUILD MODEL - PROPORTION OF 'PAGE'S BY YEAR (CONTINUOUS PREDICTOR) ####</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>year.lm <span class="ot">=</span> <span class="fu">lm</span>(prop_log10 <span class="sc">~</span> year, <span class="at">data =</span> data_stats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Store the model in an object: <code>year.lm</code></li>
<li>Using names like “sex.plot”, “name.plot”, “year.lm” is a useful convention to know what objects are.</li>
<li>The model itself is lm(prop_log10 ~ year), with prop_log10 as the dependent variable and year as the predictor.</li>
<li>To look at the output, we call <code>summary()</code>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>year.lm_sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(year.lm)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>year.lm_sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = prop_log10 ~ year, data = data_stats)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.61168 -0.21669 -0.01011  0.21070  0.63950 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -7.2755739  1.6258109  -4.475 1.39e-05 ***
year         0.0012298  0.0008314   1.479    0.141    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2855 on 172 degrees of freedom
Multiple R-squared:  0.01256,   Adjusted R-squared:  0.006821 
F-statistic: 2.188 on 1 and 172 DF,  p-value: 0.1409</code></pre>
</div>
</div>
<ul>
<li>Exact numbers of intercept and slope are not very informative, because they are log transformed values.</li>
<li>Effect of year not significant: t =1.48, p = 0.141</li>
<li>We can look at the residuals with the call <code>resid()</code>. Here, I store them and then look at the fist values:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>year.lm_resid <span class="ot">&lt;-</span> <span class="fu">resid</span>(year.lm_sum)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(year.lm_resid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          1           2           3           4           5           6 
0.458328911 0.002919516 0.306492439 0.320914578 0.155653238 0.223908801 </code></pre>
</div>
</div>
</section>
<section id="categorical-predictor-sex" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="categorical-predictor-sex"><span class="header-section-number">8.2</span> Categorical predictor: Sex</h3>
<ul>
<li>Copy your code just above from the regression with <code>year</code>, then change the predictor <code>year</code> to <code>sex</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">## BUILD MODEL - PROPORTION OF 'PAGE'S BY SEX (CATEGORICAL PREDICTOR) ####</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>sex.lm <span class="ot">=</span> <span class="fu">lm</span>(prop_log10 <span class="sc">~</span> sex, <span class="at">data =</span> data_stats)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>sex.lm_sum <span class="ot">=</span> <span class="fu">summary</span>(sex.lm)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>sex.lm_sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = prop_log10 ~ sex, data = data_stats)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.65876 -0.19694 -0.01178  0.18304  0.56589 

Coefficients:
            Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept) -4.75465    0.02860 -166.244  &lt; 2e-16 ***
sexM        -0.22706    0.03999   -5.678  5.7e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2637 on 172 degrees of freedom
Multiple R-squared:  0.1578,    Adjusted R-squared:  0.1529 
F-statistic: 32.24 on 1 and 172 DF,  p-value: 5.698e-08</code></pre>
</div>
</div>
<ul>
<li>The line “sexM” shows the effect for sex.
<ul>
<li>It is significant: t = -5.68, p = 0.</li>
</ul></li>
<li>How do you know in which direction the effect is?
<ul>
<li>R by default codes variables alphabetically, so our default level is “F” for female.</li>
<li>Coefficients indicate the change from the default to the second level (here: from F to M)</li>
<li>You can also see this because R adds “M” to the variable name: “sexM”, so it’s the effect for men (compared to women).</li>
<li>The <strong>Estimate</strong> (<span class="math inline">\(\beta\)</span>) -0.23 is negative: Less men (a lower proportion of the population) are called “Page” than women.</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
To do
</div>
</div>
<div class="callout-body-container callout-body">
<p>Save the script, commit to Git (message: “Made statistics script”), and push to GitHub.</p>
</div>
</div>
</section>
</section>
<section id="write-up-quarto-report" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="write-up-quarto-report"><span class="header-section-number">9</span> Write up: Quarto Report</h2>
<p>We repeat the steps from the last lesson (see Lesson 2 for more explanation):</p>
<ul>
<li>Save your current working environment to your write-up folder as <code>lesson3_environment</code>.</li>
<li>Open a Quarto Document.</li>
<li>Delete everything below the chunk at the top that starts and ends with <code>---</code>.</li>
<li>Save the Quarto document in your write_up folder as <code>Lesson3_Report</code>.</li>
<li>After this, insert a code chunk (Shortcut: <code>Ctrl/Cmd + Alt + I</code>) and enter the code below to load your environment.</li>
</ul>
<pre><code class="r">
```{r, echo=F}
load('lesson3_environment.RData')
```
</code></pre>
<ul>
<li><p>Add <code>echo = FALSE</code> (or only the F) in the curly brackets after r: ```<code>{r, echo = FALSE}</code>. This let’s R know you do not want to print out (echo) the code in the report, but only its results.</p></li>
<li><p>Now add sections to your report, for example: <br><br></p></li>
<li><p>Introduction</p></li>
<li><p>Results</p>
<ul>
<li>Prevalence by Year</li>
<li>Prevalence by Sex</li>
</ul></li>
<li><p>Conclusions</p></li>
<li><p>Now you can write something in each section. For example:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>We analysed how common the name "Page" was in the United States in between 1900 and</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="ss">2000. </span>We used data from the USA Social Security Administration on baby names. </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>We used linear regression to analyse the change of the name over time, and the </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>difference of the name's popularity between men and women. </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>In the Results sections, you can include the figures and model results by calling the objects within a code chunk:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prevalence by Year</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>We built a linear model to test the effect of year on the proportion of people </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>with the name "Page". Proportion was log base 10 transformed, because it was </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>not normally distributed. </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>There was no significant change in the popularity of the name over time. The</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>positive coefficients indicates a slightly increasing slope over time. </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code class="r">
```{r, echo=F}
year.plot
year.lm_sum
```
</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prevalence by Sex</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>The name is more popular among women then men. </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code class="r">
```{r, echo=F}
sex.plot
sex.lm_sum
```
</code></pre>
<ul>
<li>You can continue describing your results and the conclusion at home.</li>
<li>To compile the Quarto report, click <code>Render</code> at the top of the Quarto document.</li>
<li>You can change the format from html, to docx, or pdf.</li>
</ul>
</section>
<section id="references-resources" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="references-resources"><span class="header-section-number">10</span> References &amp; Resources</h2>
<p>This lesson closely follows: Page Piccinini (2018). “R for Publication”, <a href="https://pagepiccinini.com/r-course/lesson-2-linear-regression/">Lesson 2: Linear Regression</a>.</p>
<ul>
<li>The completed code for the lesson can be found <a href="https://github.com/hannahmetzler/R_intro_lesson3">here</a>.</li>
<li>Use git clone to download it into a folder on your computer, or download just the file you need.</li>
<li>For Quarto tips and tricks, check the online documentation: <a href="https://quarto.org/docs/visual-editor/options.html">https://quarto.org/</a>
<ul>
<li>Shortcuts and options: <a href="https://quarto.org/docs/visual-editor/options.html" class="uri">https://quarto.org/docs/visual-editor/options.html</a></li>
</ul></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>