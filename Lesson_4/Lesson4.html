<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hannah Metzler">
<meta name="dcterms.date" content="2024-03-27">

<title>Lesson 3 extension: Data wrangling, t-tests and ANOVA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Lesson4_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lesson4_files/libs/quarto-html/quarto.js"></script>
<script src="Lesson4_files/libs/quarto-html/popper.min.js"></script>
<script src="Lesson4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Lesson4_files/libs/quarto-html/anchor.min.js"></script>
<link href="Lesson4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lesson4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Lesson4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Lesson4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Lesson4_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#project-for-extension-of-lesson-3-comparison-of-babynames-in-austria-and-the-us" id="toc-project-for-extension-of-lesson-3-comparison-of-babynames-in-austria-and-the-us" class="nav-link active" data-scroll-target="#project-for-extension-of-lesson-3-comparison-of-babynames-in-austria-and-the-us"><span class="header-section-number">1</span> Project for extension of lesson 3: Comparison of babynames in Austria and the US</a></li>
  <li><a href="#reading-in-and-looking-at-data" id="toc-reading-in-and-looking-at-data" class="nav-link" data-scroll-target="#reading-in-and-looking-at-data"><span class="header-section-number">2</span> Reading in and looking at data</a>
  <ul class="collapse">
  <li><a href="#data-from-austria" id="toc-data-from-austria" class="nav-link" data-scroll-target="#data-from-austria"><span class="header-section-number">2.1</span> Data from Austria</a></li>
  <li><a href="#data-from-the-us" id="toc-data-from-the-us" class="nav-link" data-scroll-target="#data-from-the-us"><span class="header-section-number">2.2</span> Data from the US</a></li>
  </ul></li>
  <li><a href="#get-an-overview-of-the-dataset" id="toc-get-an-overview-of-the-dataset" class="nav-link" data-scroll-target="#get-an-overview-of-the-dataset"><span class="header-section-number">3</span> Get an overview of the dataset</a></li>
  <li><a href="#cleaning-and-organizing-the-data" id="toc-cleaning-and-organizing-the-data" class="nav-link" data-scroll-target="#cleaning-and-organizing-the-data"><span class="header-section-number">4</span> Cleaning and organizing the data</a>
  <ul class="collapse">
  <li><a href="#renaming-columns" id="toc-renaming-columns" class="nav-link" data-scroll-target="#renaming-columns"><span class="header-section-number">4.1</span> Renaming columns</a></li>
  <li><a href="#selecting-rows" id="toc-selecting-rows" class="nav-link" data-scroll-target="#selecting-rows"><span class="header-section-number">4.2</span> Selecting rows</a></li>
  <li><a href="#changing-the-format-of-columns" id="toc-changing-the-format-of-columns" class="nav-link" data-scroll-target="#changing-the-format-of-columns"><span class="header-section-number">4.3</span> Changing the format of columns</a></li>
  <li><a href="#create-a-new-variable" id="toc-create-a-new-variable" class="nav-link" data-scroll-target="#create-a-new-variable"><span class="header-section-number">4.4</span> Create a new variable</a></li>
  <li><a href="#grouping-data-and-summarising-statistics" id="toc-grouping-data-and-summarising-statistics" class="nav-link" data-scroll-target="#grouping-data-and-summarising-statistics"><span class="header-section-number">4.5</span> Grouping data and summarising statistics</a></li>
  <li><a href="#filter-out-your-name" id="toc-filter-out-your-name" class="nav-link" data-scroll-target="#filter-out-your-name"><span class="header-section-number">4.6</span> Filter out your name</a></li>
  </ul></li>
  <li><a href="#combine-two-data-frames" id="toc-combine-two-data-frames" class="nav-link" data-scroll-target="#combine-two-data-frames"><span class="header-section-number">5</span> Combine two data frames</a></li>
  <li><a href="#figures-script" id="toc-figures-script" class="nav-link" data-scroll-target="#figures-script"><span class="header-section-number">6</span> Figures script</a></li>
  <li><a href="#statistics-script" id="toc-statistics-script" class="nav-link" data-scroll-target="#statistics-script"><span class="header-section-number">7</span> Statistics script</a>
  <ul class="collapse">
  <li><a href="#t-test-by-country" id="toc-t-test-by-country" class="nav-link" data-scroll-target="#t-test-by-country"><span class="header-section-number">7.1</span> T-test by country</a></li>
  <li><a href="#multifactorial-anova-difference-in-name-popularity-by-sex-and-country" id="toc-multifactorial-anova-difference-in-name-popularity-by-sex-and-country" class="nav-link" data-scroll-target="#multifactorial-anova-difference-in-name-popularity-by-sex-and-country"><span class="header-section-number">7.2</span> Multifactorial ANOVA: Difference in name popularity by sex and country</a></li>
  <li><a href="#make-a-table-with-statistics-and-export" id="toc-make-a-table-with-statistics-and-export" class="nav-link" data-scroll-target="#make-a-table-with-statistics-and-export"><span class="header-section-number">7.3</span> Make a table with statistics and export:</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lesson 3 extension: Data wrangling, t-tests and ANOVA</h1>
<p class="subtitle lead">Course website: https://hannahmetzler.eu/R_intro/</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hannah Metzler </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 27, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="project-for-extension-of-lesson-3-comparison-of-babynames-in-austria-and-the-us" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="project-for-extension-of-lesson-3-comparison-of-babynames-in-austria-and-the-us"><span class="header-section-number">1</span> Project for extension of lesson 3: Comparison of babynames in Austria and the US</h2>
<p>What about baby names in Austria?</p>
<ul>
<li>Below, we read in data from Austria, make it comparable to the US data set, and then run a t-test to compare the popularity of baby names in the two countries.</li>
</ul>
</section>
<section id="reading-in-and-looking-at-data" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="reading-in-and-looking-at-data"><span class="header-section-number">2</span> Reading in and looking at data</h2>
<section id="data-from-austria" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="data-from-austria"><span class="header-section-number">2.1</span> Data from Austria</h3>
<ul>
<li>I downloaded data about given names in Austria from 1984 to 2022 from <a href="https://www.data.gv.at/katalog/de/dataset/stat_vornamen#resources">data.bv.at</a>. Download the first file from there and put it into your data folder.</li>
</ul>
<p>Continue working in your cleaning script from lesson 3, in the # READ DATA #### section.</p>
<ul>
<li>To read the Austrian data, try the function <code>csv()</code>.</li>
<li>Add this after the lines that read in the data from the USA.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data_aut <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">'data/OGDEXT_VORNAMEN_1.csv'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_aut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">C-JAHR-0;C-WOHNBEZIRK-0;C-GESCHLECHT-0;F-VORNAME_NORMALISIERT;F-ANZAHL_LGEB</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1984;101;1;Andreas;4</td>
</tr>
<tr class="even">
<td style="text-align: left;">1984;101;1;Bernd;1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1984;101;1;Christian;2</td>
</tr>
<tr class="even">
<td style="text-align: left;">1984;101;1;Christoph;2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1984;101;1;Clemens;1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1984;101;1;Daniel;3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>You can see that the data was not read in correctly. Why?</p>
<ul>
<li>Cells in CSV-files are most commonly separated by a comma, with the point used for the decimal point.</li>
<li>In some European countries (including Austria) cells are instead separated by a semicolon, and a comma used as the decimal point.</li>
<li>Here, you can see that these data from Austria are indeed separated by a semicolon.</li>
<li>If you check the help section for <code>?read_csv</code>, you see that you can use the function <code>read_csv2()</code> to read in CSV-files with the field separator <code>;</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_aut <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(<span class="st">'data/OGDEXT_VORNAMEN_1.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_aut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 30%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">C-JAHR-0</th>
<th style="text-align: right;">C-WOHNBEZIRK-0</th>
<th style="text-align: right;">C-GESCHLECHT-0</th>
<th style="text-align: left;">F-VORNAME_NORMALISIERT</th>
<th style="text-align: right;">F-ANZAHL_LGEB</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1984</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Andreas</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">1984</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Bernd</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1984</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Christian</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1984</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Christoph</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1984</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Clemens</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1984</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Daniel</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="data-from-the-us" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="data-from-the-us"><span class="header-section-number">2.2</span> Data from the US</h3>
<p>Here, I load again the baby names data set from lesson 3, and assign it to <code>data_usa</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data_usa <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(<span class="st">"data/lesson2_data_babynames.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="get-an-overview-of-the-dataset" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="get-an-overview-of-the-dataset"><span class="header-section-number">3</span> Get an overview of the dataset</h2>
<p>To get an overview of this new data set, you could use any of the following functions:</p>
<ul>
<li>You know <code>glimpse()</code> from lesson 3.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(data_aut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,265,460
Columns: 5
$ `C-JAHR-0`               &lt;dbl&gt; 1984, 1984, 1984, 1984, 1984, 1984, 1984, 198…
$ `C-WOHNBEZIRK-0`         &lt;dbl&gt; 101, 101, 101, 101, 101, 101, 101, 101, 101, …
$ `C-GESCHLECHT-0`         &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ `F-VORNAME_NORMALISIERT` &lt;chr&gt; "Andreas", "Bernd", "Christian", "Christoph",…
$ `F-ANZAHL_LGEB`          &lt;dbl&gt; 4, 1, 2, 2, 1, 3, 2, 1, 3, 1, 1, 1, 1, 1, 1, …</code></pre>
</div>
</div>
<ul>
<li>summary() shows us that the earliest year in the data is 1984, the latest one 2022.
<ul>
<li>It also shows us that the column “Geschlecht” (sex) is not yet coded as a categorical variable.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_aut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    C-JAHR-0    C-WOHNBEZIRK-0 C-GESCHLECHT-0  F-VORNAME_NORMALISIERT
 Min.   :1984   Min.   :101    Min.   :1.000   Length:1265460        
 1st Qu.:1996   1st Qu.:319    1st Qu.:1.000   Class :character      
 Median :2007   Median :506    Median :2.000   Mode  :character      
 Mean   :2005   Mean   :563    Mean   :1.535                         
 3rd Qu.:2015   3rd Qu.:804    3rd Qu.:2.000                         
 Max.   :2022   Max.   :923    Max.   :2.000                         
 F-ANZAHL_LGEB  
 Min.   : 1.00  
 1st Qu.: 1.00  
 Median : 1.00  
 Mean   : 2.36  
 3rd Qu.: 2.00  
 Max.   :76.00  </code></pre>
</div>
</div>
<ul>
<li>The function <code>View()</code> opens the data in an extra window.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(data_aut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The function <code>str()</code> shows you the structure of the data set.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_aut) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [1,265,460 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ C-JAHR-0              : num [1:1265460] 1984 1984 1984 1984 1984 ...
 $ C-WOHNBEZIRK-0        : num [1:1265460] 101 101 101 101 101 101 101 101 101 101 ...
 $ C-GESCHLECHT-0        : num [1:1265460] 1 1 1 1 1 1 1 1 1 1 ...
 $ F-VORNAME_NORMALISIERT: chr [1:1265460] "Andreas" "Bernd" "Christian" "Christoph" ...
 $ F-ANZAHL_LGEB         : num [1:1265460] 4 1 2 2 1 3 2 1 3 1 ...
 - attr(*, "spec")=
  .. cols(
  ..   `C-JAHR-0` = col_double(),
  ..   `C-WOHNBEZIRK-0` = col_double(),
  ..   `C-GESCHLECHT-0` = col_double(),
  ..   `F-VORNAME_NORMALISIERT` = col_character(),
  ..   `F-ANZAHL_LGEB` = col_double()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
</div>
</section>
<section id="cleaning-and-organizing-the-data" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="cleaning-and-organizing-the-data"><span class="header-section-number">4</span> Cleaning and organizing the data</h2>
<section id="renaming-columns" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="renaming-columns"><span class="header-section-number">4.1</span> Renaming columns</h3>
<p>Let’s use more useful column names for coding, and choose the same names as in the US baby names data. Check the names of the US data with <code>names()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_usa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "year" "sex"  "name" "n"    "prop"</code></pre>
</div>
</div>
<p>We can use the <code>dplyr::rename()</code>function to change column names.</p>
<ul>
<li>You simply assign each old variable name (in quotation marks) to the new variable name.</li>
<li>Add the following in your # CLEAN DATA #### section:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_aut_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
   year living_district   sex name          n
  &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
1  1984             101     1 Andreas       4
2  1984             101     1 Bernd         1
3  1984             101     1 Christian     2
4  1984             101     1 Christoph     2
5  1984             101     1 Clemens       1
6  1984             101     1 Daniel        3</code></pre>
</div>
</div>
</section>
<section id="selecting-rows" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="selecting-rows"><span class="header-section-number">4.2</span> Selecting rows</h3>
<p>If we compare the US and the Austrian data set, we can see that they cover different time spans.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_usa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      year          sex                name                 n          
 Min.   :1880   Length:2370        Length:2370        Min.   :    5.0  
 1st Qu.:1931   Class :character   Class :character   1st Qu.:   17.0  
 Median :1965   Mode  :character   Mode  :character   Median :  102.0  
 Mean   :1960                                         Mean   :  975.2  
 3rd Qu.:1990                                         3rd Qu.:  418.8  
 Max.   :2017                                         Max.   :54851.0  
      prop          
 Min.   :2.310e-06  
 1st Qu.:1.247e-05  
 Median :8.686e-05  
 Mean   :5.916e-04  
 3rd Qu.:4.013e-04  
 Max.   :2.927e-02  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_aut_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      year      living_district      sex            name          
 Min.   :1984   Min.   :101     Min.   :1.000   Length:1265460    
 1st Qu.:1996   1st Qu.:319     1st Qu.:1.000   Class :character  
 Median :2007   Median :506     Median :2.000   Mode  :character  
 Mean   :2005   Mean   :563     Mean   :1.535                     
 3rd Qu.:2015   3rd Qu.:804     3rd Qu.:2.000                     
 Max.   :2022   Max.   :923     Max.   :2.000                     
       n        
 Min.   : 1.00  
 1st Qu.: 1.00  
 Median : 1.00  
 Mean   : 2.36  
 3rd Qu.: 2.00  
 Max.   :76.00  </code></pre>
</div>
</div>
<p>Let’s keep only years we have in both datasets. First, filtering the Austrian dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years up to 2017</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2017</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the new data frame</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_aut_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      year      living_district      sex            name          
 Min.   :1984   Min.   :101     Min.   :1.000   Length:1047654    
 1st Qu.:1994   1st Qu.:319     1st Qu.:1.000   Class :character  
 Median :2004   Median :506     Median :2.000   Mode  :character  
 Mean   :2002   Mean   :560     Mean   :1.541                     
 3rd Qu.:2011   3rd Qu.:804     3rd Qu.:2.000                     
 Max.   :2017   Max.   :923     Max.   :2.000                     
       n         
 Min.   : 1.000  
 1st Qu.: 1.000  
 Median : 1.000  
 Mean   : 2.458  
 3rd Qu.: 2.000  
 Max.   :76.000  </code></pre>
</div>
</div>
<ul>
<li>Next, filter out all years before 1984 from the USA data set:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>data_usa_clean <span class="ot">=</span> data_usa <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years from 1984 on</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1983</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_usa_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      year          sex                name                 n          
 Min.   :1984   Length:766         Length:766         Min.   :    5.0  
 1st Qu.:1991   Class :character   Class :character   1st Qu.:   20.0  
 Median :1999   Mode  :character   Mode  :character   Median :  159.5  
 Mean   :2000                                         Mean   : 1931.1  
 3rd Qu.:2008                                         3rd Qu.:  638.5  
 Max.   :2017                                         Max.   :54851.0  
      prop          
 Min.   :2.320e-06  
 1st Qu.:9.810e-06  
 Median :8.263e-05  
 Mean   :9.865e-04  
 3rd Qu.:3.199e-04  
 Max.   :2.927e-02  </code></pre>
</div>
</div>
</section>
<section id="changing-the-format-of-columns" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="changing-the-format-of-columns"><span class="header-section-number">4.3</span> Changing the format of columns</h3>
<p>To run tests comparing both countries, we need to join both data frames into one. There are several steps to prepare our data sets for this.</p>
<ul>
<li>First, columns in both data frames need the same format.</li>
<li>The US data had the following formats (see second column):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(data_usa_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 67
Columns: 5
$ year &lt;dbl&gt; 1984, 1984, 1985, 1985, 1986, 1986, 1987, 1987, 1988, 1988, 1989,…
$ sex  &lt;chr&gt; "F", "M", "F", "M", "F", "M", "F", "M", "F", "M", "F", "M", "F", …
$ name &lt;chr&gt; "Hannah", "Hannah", "Hannah", "Hannah", "Hannah", "Hannah", "Hann…
$ n    &lt;int&gt; 2266, 14, 2448, 8, 3385, 12, 4592, 26, 5559, 22, 7830, 46, 10274,…
$ prop &lt;dbl&gt; 0.00125687, 0.00000746, 0.00132618, 0.00000416, 0.00183464, 0.000…</code></pre>
</div>
</div>
<p>So, in the Austrian data, we need sex to be a character vector with levels “M” and “F” instead of “1” and “2”.</p>
<ul>
<li>We will use the <code>ifelse()</code> function, within a <code>mutate()</code> call to transform the variable <code>sex</code>.</li>
<li>If you check the help for <code>?ifelse</code>, the Usage section shows you how to use it: <code>ifelse(test, yes, no)</code>.</li>
<li>The arguments for the <code>ifelse()</code> function start with a condition (rows where the column sex is equal to “1”), then specifies what happens if the condition is met (use the label “M”), and then lists what should happen otherwise/else (use the label “F”).</li>
<li>Now, add this as a last line to where you created <code>data_aut_clean</code>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years up to 2017</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recode the levels of sex from 1 and 2, to M and F</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"1"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>))</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># check if there is now F instead of 1, and M instead of M: </span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data_aut_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,047,654
Columns: 5
$ year            &lt;dbl&gt; 1984, 1984, 1984, 1984, 1984, 1984, 1984, 1984, 1984, …
$ living_district &lt;dbl&gt; 101, 101, 101, 101, 101, 101, 101, 101, 101, 101, 101,…
$ sex             &lt;chr&gt; "M", "M", "M", "M", "M", "M", "M", "M", "M", "M", "M",…
$ name            &lt;chr&gt; "Andreas", "Bernd", "Christian", "Christoph", "Clemens…
$ n               &lt;dbl&gt; 4, 1, 2, 2, 1, 3, 2, 1, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</code></pre>
</div>
</div>
</section>
<section id="create-a-new-variable" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="create-a-new-variable"><span class="header-section-number">4.4</span> Create a new variable</h3>
<p>Next, we need to tell statistics from Austria and the US apart, once they are in a joint data frame. Therefore, let’s add a variable that identifies the country.</p>
<ul>
<li>We use <code>rep()</code> to repeat “Austria” n times, and set <code>nrow()</code> to the number of rows of the Austrian data.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years up to 2017</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recode the levels of sex from 1 and 2, to M and F</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"1"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create a country variable for Austria</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="st">"Austria"</span>, <span class="at">n=</span><span class="fu">nrow</span>(data_aut)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s repeat this step for the USA data. Just add a line to where you started to clean the US data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>data_usa_clean <span class="ot">=</span> data_usa <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years from 1984 on</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1983</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Create a country variable for the US</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="st">"USA"</span>, <span class="at">n=</span><span class="fu">nrow</span>(babynames)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grouping-data-and-summarising-statistics" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="grouping-data-and-summarising-statistics"><span class="header-section-number">4.5</span> Grouping data and summarising statistics</h3>
<p>The US data did not separate names per living district.</p>
<ul>
<li>To make our Austrian data similar, let’s group names across districts, so that we get the total number of names per year and sex.</li>
<li>Using <code>group_by()</code> first group the data by year, sex and name, because we want the total n for each of these combined categories.
<ul>
<li>We also add the column country, because we want to keep it, although it does not create any additional grouping.</li>
</ul></li>
<li>We then <code>summarise()</code> the data by calculating the <code>sum()</code> of the number of names (n).
<ul>
<li><code>summarise()</code> is similar to <code>mutate()</code>, but creates one line of output per group. Here, it collapses across districts, reducing the row number for each name.</li>
<li><code>mutate()</code> creates as many lines of output as input.</li>
</ul></li>
<li>Finally, we <code>ungroup()</code> the data again.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years up to 2017</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recode the levels of sex from 1 and 2, to M and F</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"1"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create a country variable for Austria</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="st">"Austria"</span>, <span class="at">n=</span><span class="fu">nrow</span>(data_aut))) <span class="sc">%&gt;%</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#group by year, sex and name and calculate the new sum for each category</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, sex, name, country) <span class="sc">%&gt;%</span> </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we also want to calculate the proportion variable that exists in the US data set (propotion of babies getting each name).</p>
<ul>
<li>N, the total number of babies, is obviously different because the US is larger.</li>
<li>Using the proportion allows us to meaningfully compare the popularity of names between countries.</li>
<li>We first want to calculate the sum of all babies born in each year (<code>n_total</code>), and then divide n of each name by the years’ total.</li>
<li>To calculate the sum per year, we again use <code>group_by()</code>, grouping only by year.
<ul>
<li>We again add country, also this does not create a group, to keep country variable.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years up to 2017</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recode the levels of sex from 1 and 2, to M and F</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"1"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create a country variable for Austria</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="st">"Austria"</span>, <span class="at">n=</span><span class="fu">nrow</span>(data_aut))) <span class="sc">%&gt;%</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#group by year, sex and name and calculate the new sum for each category</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, sex, name, country) <span class="sc">%&gt;%</span> </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span>  <span class="co"># see lesson 3 page for documentation</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate total number of birth per year, and then proportion for each name out of this total</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, country) <span class="sc">%&gt;%</span> </span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_total =</span> <span class="fu">sum</span>(n), </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop =</span> n<span class="sc">/</span>n_total) <span class="sc">%&gt;%</span> </span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_aut_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
   year sex   name     country     n n_total      prop
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
1  1984 F     Abigail  Austria     1   83856 0.0000119
2  1984 F     Adele    Austria     2   83856 0.0000239
3  1984 F     Adelheid Austria    23   83856 0.000274 
4  1984 F     Adina    Austria     2   83856 0.0000239
5  1984 F     Adriane  Austria     1   83856 0.0000119
6  1984 F     Agata    Austria     1   83856 0.0000119</code></pre>
</div>
</div>
</section>
<section id="filter-out-your-name" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="filter-out-your-name"><span class="header-section-number">4.6</span> Filter out your name</h3>
<p>Once this is done, you can again filter out your own name (or the name “Hannah”) by adding another filter() call to each of the data sets. After this, the cleaning and data organizing is finished~</p>
<p>Austrian data set complete data cleaning and organizing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>data_aut_clean <span class="ot">&lt;-</span> data_aut <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> <span class="st">'C-JAHR-0'</span>, </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="st">'C-GESCHLECHT-0'</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">living_district =</span> <span class="st">'C-WOHNBEZIRK-0'</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="st">'F-VORNAME_NORMALISIERT'</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="st">'F-ANZAHL_LGEB'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years up to 2017</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Re-code the levels of sex from 1 and 2, to M and F</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"1"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create a country variable for Austria</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="st">"Austria"</span>, <span class="at">n=</span><span class="fu">nrow</span>(data_aut))) <span class="sc">%&gt;%</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#group by year, sex and name and calculate the new sum for each category</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, sex, name, country) <span class="sc">%&gt;%</span> </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span>  <span class="co"># see lesson 3 page for documentation</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate total number of birth per year, and then proportion for each name out of this total</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, country) <span class="sc">%&gt;%</span> </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_total =</span> <span class="fu">sum</span>(n), </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop =</span> n<span class="sc">/</span>n_total) <span class="sc">%&gt;%</span> </span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter out your name</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Hannah"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>USA data set complete data cleaning and organizing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>data_usa_clean <span class="ot">=</span> data_usa <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#keep only years from 1984 on</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">1983</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Create a country variable for the US</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">rep</span>(<span class="st">"USA"</span>, <span class="at">n=</span><span class="fu">nrow</span>(data_usa))) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter out your name</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Hannah"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Have a look at both organized data sets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_usa_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
   year sex   name       n       prop country
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;  
1  1984 F     Hannah  2266 0.00126    USA    
2  1984 M     Hannah    14 0.00000746 USA    
3  1985 F     Hannah  2448 0.00133    USA    
4  1985 M     Hannah     8 0.00000416 USA    
5  1986 F     Hannah  3385 0.00183    USA    
6  1986 M     Hannah    12 0.00000625 USA    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_aut_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
   year sex   name   country     n n_total     prop
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1  1984 F     Hannah Austria    11   83856 0.000131
2  1985 F     Hannah Austria    16   82379 0.000194
3  1986 F     Hannah Austria    19   82056 0.000232
4  1987 F     Hannah Austria    43   81351 0.000529
5  1988 F     Hannah Austria    50   82545 0.000606
6  1989 F     Hannah Austria    64   82492 0.000776</code></pre>
</div>
</div>
</section>
</section>
<section id="combine-two-data-frames" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="combine-two-data-frames"><span class="header-section-number">5</span> Combine two data frames</h2>
<p>Now we can combine the 2 data frames. We’ll learn about dplyr verbs that work on two data frames. Until now, all verbs (filter, mutate, summarise, rename, recode) manipulated only one data frame.</p>
<ul>
<li>We will use the function <code>full_join</code>: it
<ul>
<li>R looks for column they have in common</li>
<li>then looks for rows that have the same matching values</li>
<li>combines them into a new data frame, including all the other columns from both data frames</li>
</ul></li>
<li><code>full_join()</code> is one of 4 Mutating joins. It keeps all observations from both data frames.</li>
<li>Check out inner_join, right_join, and left_join with the Examples provided in the help on <code>?full_join</code> when you have a moment. It takes a bit of time to understand them.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>data_combined <span class="ot">&lt;-</span> data_usa_clean <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(data_aut_clean) </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
   year sex   name       n       prop country n_total
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
1  1984 F     Hannah  2266 0.00126    USA          NA
2  1984 M     Hannah    14 0.00000746 USA          NA
3  1985 F     Hannah  2448 0.00133    USA          NA
4  1985 M     Hannah     8 0.00000416 USA          NA
5  1986 F     Hannah  3385 0.00183    USA          NA
6  1986 M     Hannah    12 0.00000625 USA          NA</code></pre>
</div>
</div>
<ul>
<li>To see data points from both countries, you could sort values by year using <code>arrange()</code>.</li>
<li>In addition, lets transform the columns sex and country into categorical variables (factors).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>data_combined <span class="ot">&lt;-</span> data_usa_clean <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># join the two data frames</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(data_aut_clean) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sort by year</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year)<span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform sex into a factor</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">factor</span>(sex)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform country into a factor with 2 levels:</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">factor</span>(country))</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
   year sex   name       n       prop country n_total
  &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt;  &lt;dbl&gt;      &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt;
1  1984 F     Hannah  2266 0.00126    USA          NA
2  1984 M     Hannah    14 0.00000746 USA          NA
3  1984 F     Hannah    11 0.000131   Austria   83856
4  1985 F     Hannah  2448 0.00133    USA          NA
5  1985 M     Hannah     8 0.00000416 USA          NA
6  1985 F     Hannah    16 0.000194   Austria   82379</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      year      sex        name                 n              prop          
 Min.   :1984   F:68   Length:101         Min.   :    5   Min.   :2.450e-06  
 1st Qu.:1992   M:33   Class :character   1st Qu.:   22   1st Qu.:1.143e-05  
 Median :2000          Mode  :character   Median :  429   Median :3.112e-03  
 Mean   :2000                             Mean   : 4005   Mean   :3.396e-03  
 3rd Qu.:2009                             3rd Qu.: 6566   3rd Qu.:6.067e-03  
 Max.   :2017                             Max.   :23080   Max.   :1.157e-02  
                                                                             
    country      n_total     
 Austria:34   Min.   :64431  
 USA    :67   1st Qu.:67446  
              Median :77189  
              Mean   :75747  
              3rd Qu.:82372  
              Max.   :85333  
              NA's   :67     </code></pre>
</div>
</div>
<p>Finally, you might want to drop the column n_total, which only has values for Austria. You can do this with <code>select()</code>:</p>
<ul>
<li>It selects the columns you list.</li>
<li>if you add a minus, it deletes the columns you list</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>data_combined <span class="ot">&lt;-</span> data_usa_clean <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># join the two data frames</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(data_aut_clean) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sort by year</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year)<span class="sc">%&gt;%</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform sex into a factor</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">factor</span>(sex)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform country into a factor with 2 levels:</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">factor</span>(country)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n_total) <span class="co"># to delete multiple columns: -c("column_1", "column_2")</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>data_combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 101 × 6
    year sex   name       n       prop country
   &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt;  &lt;dbl&gt;      &lt;dbl&gt; &lt;fct&gt;  
 1  1984 F     Hannah  2266 0.00126    USA    
 2  1984 M     Hannah    14 0.00000746 USA    
 3  1984 F     Hannah    11 0.000131   Austria
 4  1985 F     Hannah  2448 0.00133    USA    
 5  1985 M     Hannah     8 0.00000416 USA    
 6  1985 F     Hannah    16 0.000194   Austria
 7  1986 F     Hannah  3385 0.00183    USA    
 8  1986 M     Hannah    12 0.00000625 USA    
 9  1986 F     Hannah    19 0.000232   Austria
10  1987 F     Hannah  4592 0.00245    USA    
# ℹ 91 more rows</code></pre>
</div>
</div>
</section>
<section id="figures-script" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="figures-script"><span class="header-section-number">6</span> Figures script</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_combined, <span class="fu">aes</span>(country, prop, <span class="at">fill =</span> sex)) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"dodgerblue"</span>)) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Country"</span>, <span class="at">y =</span> <span class="st">"Proportion"</span>) <span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">family =</span> <span class="st">"Times"</span>))<span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Popularity of the name </span><span class="sc">\"</span><span class="st">Hannah</span><span class="sc">\"</span><span class="st"> by country and sex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson4_files/figure-html/pet-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 1. Scores by pet type and country.</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>In Austria, there are no men with the name Hannah.</li>
<li>In the US, there are very few.</li>
</ul>
</section>
<section id="statistics-script" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="statistics-script"><span class="header-section-number">7</span> Statistics script</h2>
<section id="t-test-by-country" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="t-test-by-country"><span class="header-section-number">7.1</span> T-test by country</h3>
<p>Is your name more popular in Austria or the USA? Although this data is not normally distributed, I want to show you how to do a t-test:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># t-test between countries</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(prop <span class="sc">~</span> country, <span class="at">data =</span> data_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  prop by country
t = 1.9179, df = 87.086, p-value = 0.05841
alternative hypothesis: true difference in means between group Austria and group USA is not equal to 0
95 percent confidence interval:
 -4.481698e-05  2.510436e-03
sample estimates:
mean in group Austria     mean in group USA 
          0.004214066           0.002981257 </code></pre>
</div>
</div>
<ul>
<li>You can see that “Hannah” is more popular in Austria compared to the US.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># t-test between men and women</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(prop <span class="sc">~</span> sex, <span class="at">data =</span> data_combined)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  prop by sex
t = 13.781, df = 67.002, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means between group F and group M is not equal to 0
95 percent confidence interval:
 0.004301650 0.005758776
sample estimates:
mean in group F mean in group M 
   5.039797e-03    9.583939e-06 </code></pre>
</div>
</div>
<ul>
<li>You can see that “Hannah” is much more frequent in females than males.</li>
</ul>
</section>
<section id="multifactorial-anova-difference-in-name-popularity-by-sex-and-country" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="multifactorial-anova-difference-in-name-popularity-by-sex-and-country"><span class="header-section-number">7.2</span> Multifactorial ANOVA: Difference in name popularity by sex and country</h3>
<p>If you want to investigate if your name is more popular for men or women, and if this difference varies across countries, you could run an ANOVA (analysis of variance) with two factors (sex and country).</p>
<p>I recommend using the package “ez” for this. Load it at the top of your statistics script.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install in the console</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"ez"</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># In your script: </span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ez)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For an ANOVA, you need your data in a wide format, that is, a separate column for Austria and the US, and for the two sexes.</p>
<ul>
<li>For this, you can use the function <code>pivot_wider()</code> from the tidyverse package <code>tidyr</code>.</li>
<li>Install the package, and load the library at the start of your statistics script.</li>
</ul>
<p>Continue lesson preparation here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(data_combined, <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"name"</span>), <span class="at">names_from =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"sex"</span>), <span class="at">values_from =</span> <span class="st">"prop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 34 × 5
    year name     USA_F      USA_M Austria_F
   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1  1984 Hannah 0.00126 0.00000746  0.000131
 2  1985 Hannah 0.00133 0.00000416  0.000194
 3  1986 Hannah 0.00183 0.00000625  0.000232
 4  1987 Hannah 0.00245 0.0000133   0.000529
 5  1988 Hannah 0.00289 0.0000110   0.000606
 6  1989 Hannah 0.00393 0.0000220   0.000776
 7  1990 Hannah 0.00500 0.0000135   0.000840
 8  1991 Hannah 0.00530 0.0000108   0.000892
 9  1992 Hannah 0.00573 0.00000572  0.00140 
10  1993 Hannah 0.00634 0.0000092   0.00135 
# ℹ 24 more rows</code></pre>
</div>
</div>
<p>After your other analyses, you can add the ANOVA in your statistics script:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # ezANOVA</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ezANOVA(data = data_combined,</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">#         dv = prop,</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">#         wid = year,</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         between = .("sex", "country"),</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#         type = 3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="make-a-table-with-statistics-and-export" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="make-a-table-with-statistics-and-export"><span class="header-section-number">7.3</span> Make a table with statistics and export:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> data_combined <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, sex) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_proportion =</span> <span class="fu">mean</span>(prop), </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_percent =</span> mean_proportion<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>summary_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
# Groups:   country [2]
  country sex       n mean_proportion mean_percent
  &lt;fct&gt;   &lt;fct&gt; &lt;int&gt;           &lt;dbl&gt;        &lt;dbl&gt;
1 Austria F        34      0.00421        0.421   
2 USA     F        34      0.00587        0.587   
3 USA     M        33      0.00000958     0.000958</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>